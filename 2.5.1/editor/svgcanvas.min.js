;if(!window.console){window.console={};window.console.log=function(a){};window.console.dir=function(a){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(a){}}(function(){var a=jQuery.fn.attr,b="http://www.w3.org/2000/svg";jQuery.fn.attr=function(o,l){var g=this.length;if(!g){return this}for(var f=0;f<g;f++){var c=this[f];if(c.namespaceURI===b){if(l!==undefined){c.setAttribute(o,l)}else{if($.isArray(o)){var d=o.length,e={};while(d--){var k=o[d];var h=c.getAttribute(k);if(h||h==="0"){h=isNaN(h)?h:h-0}e[k]=h}return e}else{if(typeof o==="object"){for(var m in o){c.setAttribute(m,o[m])}}else{var h=c.getAttribute(o);if(h||h==="0"){h=isNaN(h)?h:h-0}return h}}}}else{return a.apply(this,arguments)}}return this}}());$.SvgCanvas=function(aJ,aw){var k=!!window.opera,aA=navigator.userAgent.indexOf("AppleWebKit")!=-1,aZ={},aD={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},az={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties",exportNoBlur:"Blurred elements will appear as un-blurred",exportNoImage:"Image elements will not appear",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},J={show_outside_canvas:true,dimensions:[640,480]},d=function(bf){return $("<p/>").text(bf).html()},al=function(bf){return $("<p/>").html(bf).text()};if(aw){$.extend(J,aw)}var I={em:0,ex:0,px:1,cm:35.43307,mm:3.543307,"in":90,pt:1.25,pc:15,"%":0};function au(bh,bg,bi){this.elem=bh;this.text=bi?("Change "+bh.tagName+" "+bi):("Change "+bh.tagName);this.newValues={};this.oldValues=bg;for(var bf in bg){if(bf=="#text"){this.newValues[bf]=bh.textContent}else{if(bf=="#href"){this.newValues[bf]=bh.getAttributeNS(aC,"href")}else{this.newValues[bf]=bh.getAttribute(bf)}}}this.apply=function(){var bm=false;for(var bk in this.newValues){if(this.newValues[bk]){if(bk=="#text"){this.elem.textContent=this.newValues[bk]}else{if(bk=="#href"){this.elem.setAttributeNS(aC,"xlink:href",this.newValues[bk])}else{this.elem.setAttribute(bk,this.newValues[bk])}}}else{if(bk=="#text"){this.elem.textContent=""}else{this.elem.setAttribute(bk,"");this.elem.removeAttribute(bk)}}if(bk=="transform"){bm=true}else{if(bk=="stdDeviation"){bb.setBlurOffsets(this.elem.parentNode,this.newValues[bk])}}}if(!bm){var bo=bb.getRotationAngle(bh);if(bo){var bn=bh.getBBox();var bj=bn.x+bn.width/2,bp=bn.y+bn.height/2;var bl=["rotate(",bo," ",bj,",",bp,")"].join("");if(bl!=bh.getAttribute("transform")){bh.setAttribute("transform",bl)}}}if(this.elem.tagName=="title"&&this.elem.parentNode.parentNode==aj){Z()}return true};this.unapply=function(){var bm=false;for(var bk in this.oldValues){if(this.oldValues[bk]){if(bk=="#text"){this.elem.textContent=this.oldValues[bk]}else{if(bk=="#href"){this.elem.setAttributeNS(aC,"xlink:href",this.oldValues[bk])}else{this.elem.setAttribute(bk,this.oldValues[bk])}}if(bk=="stdDeviation"){bb.setBlurOffsets(this.elem.parentNode,this.oldValues[bk])}}else{if(bk=="#text"){this.elem.textContent=""}else{this.elem.removeAttribute(bk)}}if(bk=="transform"){bm=true}}if(!bm){var bo=bb.getRotationAngle(bh);if(bo){var bn=bh.getBBox();var bj=bn.x+bn.width/2,bp=bn.y+bn.height/2;var bl=["rotate(",bo," ",bj,",",bp,")"].join("");if(bl!=bh.getAttribute("transform")){bh.setAttribute("transform",bl)}}}if(this.elem.tagName=="title"&&this.elem.parentNode.parentNode==aj){Z()}if(U[this.elem.id]){delete U[this.elem.id]}return true};this.elements=function(){return[this.elem]}}function a(bf,bg){this.elem=bf;this.text=bg||("Create "+bf.tagName);this.parent=bf.parentNode;this.apply=function(){this.elem=this.parent.insertBefore(this.elem,this.elem.nextSibling);if(this.parent==aj){Z()}};this.unapply=function(){this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);if(this.parent==aj){Z()}};this.elements=function(){return[this.elem]}}function R(bg,bf,bh){this.elem=bg;this.text=bh||("Delete "+bg.tagName);this.parent=bf;this.apply=function(){if(U[this.elem.id]){delete U[this.elem.id]}this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);if(this.parent==aj){Z()}};this.unapply=function(){if(U[this.elem.id]){delete U[this.elem.id]}this.elem=this.parent.insertBefore(this.elem,this.elem.nextSibling);if(this.parent==aj){Z()}};this.elements=function(){return[this.elem]};if(U[bg.id]){delete U[bg.id]}}function S(bg,bh,bf,bi){this.elem=bg;this.text=bi?("Move "+bg.tagName+" to "+bi):("Move "+bg.tagName);this.oldNextSibling=bh;this.oldParent=bf;this.newNextSibling=bg.nextSibling;this.newParent=bg.parentNode;this.apply=function(){this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);if(this.newParent==aj){Z()}};this.unapply=function(){this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);if(this.oldParent==aj){Z()}};this.elements=function(){return[this.elem]}}function ay(bf){this.text=bf||"Batch Command";this.stack=[];this.apply=function(){var bg=this.stack.length;for(var bh=0;bh<bg;++bh){this.stack[bh].apply()}};this.unapply=function(){for(var bg=this.stack.length-1;bg>=0;bg--){this.stack[bg].unapply()}};this.elements=function(){var bg=[];var bj=this.stack.length;while(bj--){var bi=this.stack[bj].elements();var bh=bi.length;while(bh--){if(bg.indexOf(bi[bh])==-1){bg.push(bi[bh])}}}return bg};this.addSubCommand=function(bg){this.stack.push(bg)};this.isEmpty=function(){return this.stack.length==0}}function aW(bh,bg){this.id=bh;this.selectedElement=bg;this.locked=true;this.reset=function(bi,bj){this.locked=true;this.selectedElement=bi;this.resize();this.selectorGroup.setAttribute("display","inline")};this.selectorGroup=c({element:"g",attr:{id:("selectorGroup"+this.id)}});this.selectorRect=this.selectorGroup.appendChild(c({element:"path",attr:{id:("selectedBox"+this.id),fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.rotateGripConnector=this.selectorGroup.appendChild(c({element:"line",attr:{id:("selectorGrip_rotateconnector_"+this.id),stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGroup.appendChild(c({element:"circle",attr:{id:("selectorGrip_rotate_"+this.id),fill:"lime",r:4,stroke:"#22C","stroke-width":2,style:"cursor:url("+J.imgPath+"rotate.png) 12 12, auto;"}}));for(var bf in this.selectorGrips){this.selectorGrips[bf]=this.selectorGroup.appendChild(c({element:"circle",attr:{id:("selectorGrip_resize_"+bf+"_"+this.id),fill:"#22C",r:4,style:("cursor:"+bf+"-resize"),"stroke-width":2,"pointer-events":"all",display:"none"}}))}this.showGrips=function(bi){var bk=bi?"inline":"none";this.rotateGrip.setAttribute("display",bk);this.rotateGripConnector.setAttribute("display",bk);var bl=this.selectedElement;for(var bj in this.selectorGrips){this.selectorGrips[bj].setAttribute("display",bk)}if(bl){this.updateGripCursors(bb.getRotationAngle(bl))}};this.updateGripCursors=function(bm){var bl=[];var bi=Math.round(bm/45);if(bi<0){bi+=8}for(var bj in this.selectorGrips){bl.push(bj)}while(bi>0){bl.push(bl.shift());bi--}var bk=0;for(var bj in this.selectorGrips){this.selectorGrips[bj].setAttribute("style",("cursor:"+bl[bk]+"-resize"));bk++}};this.resize=function(){var bi=this.selectorRect,bp=this.selectorGrips,bF=this.selectedElement,bD=bF.getAttribute("stroke-width");var bv=1/ad;if(bF.getAttribute("stroke")!="none"&&!isNaN(bD)){bv+=(bD/2)}if(bF.tagName=="text"){bv+=2/ad}var bj=bb.getBBox(bF);if(bF.tagName=="g"){var bu=bb.getStrokedBBox(bF.childNodes);$.each(bj,function(bN,bO){bj[bN]=bu[bN]})}var bG=z(bF);bG.e*=ad;bG.f*=ad;var bH=bj.x-bv,bA=bj.y-bv,bz=bj.width+(bv*2),bJ=bj.height+(bv*2),bj={x:bH,y:bA,width:bz,height:bJ};var bL=bd(bH*ad,bA*ad,bz*ad,bJ*ad,bG),bl=bL.aabox.x,bk=bL.aabox.y,bm=bL.aabox.width,by=bL.aabox.height;var bo=bl+bm/2,bn=bk+by/2;var bK=bb.getRotationAngle(bF);if(bK){var bx=G.createSVGTransform();bx.setRotate(-bK,bo,bn);var bB=bx.matrix;bL.tl=P(bL.tl.x,bL.tl.y,bB);bL.tr=P(bL.tr.x,bL.tr.y,bB);bL.bl=P(bL.bl.x,bL.bl.y,bB);bL.br=P(bL.br.x,bL.br.y,bB);var bt=bL.tl.x,bs=bL.tl.y,br=bL.tl.x,bq=bL.tl.y;bt=Math.min(bt,Math.min(bL.tr.x,Math.min(bL.bl.x,bL.br.x)));bs=Math.min(bs,Math.min(bL.tr.y,Math.min(bL.bl.y,bL.br.y)));br=Math.max(br,Math.max(bL.tr.x,Math.max(bL.bl.x,bL.br.x)));bq=Math.max(bq,Math.max(bL.tr.y,Math.max(bL.bl.y,bL.br.y)));bl=bt;bk=bs;bm=(br-bt);by=(bq-bs)}var bM=G.suspendRedraw(100);var bC="M"+bl+","+bk+" L"+(bl+bm)+","+bk+" "+(bl+bm)+","+(bk+by)+" "+bl+","+(bk+by)+"z";ax(bi,{d:bC});var bw={nw:[bl,bk],ne:[bl+bm,bk],sw:[bl,bk+by],se:[bl+bm,bk+by],n:[bl+(bm)/2,bk],w:[bl,bk+(by)/2],e:[bl+bm,bk+(by)/2],s:[bl+(bm)/2,bk+by]};if(bF==aO[0]){for(var bE in bw){var bI=bw[bE];ax(bp[bE],{cx:bI[0],cy:bI[1]})}}if(bK){this.selectorGroup.setAttribute("transform","rotate("+[bK,bo,bn].join(",")+")")}else{this.selectorGroup.setAttribute("transform","")}ax(this.rotateGripConnector,{x1:bl+(bm)/2,y1:bk,x2:bl+(bm)/2,y2:bk-20});ax(this.rotateGrip,{cx:bl+(bm)/2,cy:bk-20});G.unsuspendRedraw(bM)};this.reset(bg)}function bc(){this.selectorParentGroup=null;this.rubberBandBox=null;this.selectors=[];this.selectorMap={};var bf=this;this.initGroup=function(){if(bf.selectorParentGroup&&bf.selectorParentGroup.parentNode){bf.selectorParentGroup.parentNode.removeChild(bf.selectorParentGroup)}bf.selectorParentGroup=aK.createElementNS(aI,"g");bf.selectorParentGroup.setAttribute("id","selectorParentGroup");G.appendChild(bf.selectorParentGroup);bf.selectorMap={};bf.selectors=[];bf.rubberBandBox=null;if($("#canvasBackground").length){return}var bg=aK.createElementNS(aI,"svg");var bi=J.dimensions;ax(bg,{id:"canvasBackground",width:bi[0],height:bi[1],x:0,y:0,overflow:"visible",style:"pointer-events:none"});var bh=aK.createElementNS(aI,"rect");ax(bh,{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"});bg.appendChild(bh);G.insertBefore(bg,aj)};this.requestSelector=function(bh){if(bh==null){return null}var bi=this.selectors.length;if(typeof(this.selectorMap[bh.id])=="object"){this.selectorMap[bh.id].locked=true;return this.selectorMap[bh.id]}for(var bg=0;bg<bi;++bg){if(this.selectors[bg]&&!this.selectors[bg].locked){this.selectors[bg].locked=true;this.selectors[bg].reset(bh);this.selectorMap[bh.id]=this.selectors[bg];return this.selectors[bg]}}this.selectors[bi]=new aW(bi,bh);this.selectorParentGroup.appendChild(this.selectors[bi].selectorGroup);this.selectorMap[bh.id]=this.selectors[bi];return this.selectors[bi]};this.releaseSelector=function(bh){if(bh==null){return}var bk=this.selectors.length,bi=this.selectorMap[bh.id];for(var bg=0;bg<bk;++bg){if(this.selectors[bg]&&this.selectors[bg]==bi){if(bi.locked==false){console.log("WARNING! selector was released but was already unlocked")}delete this.selectorMap[bh.id];bi.locked=false;bi.selectedElement=null;bi.showGrips(false);try{bi.selectorGroup.setAttribute("display","none")}catch(bj){}break}}};this.getRubberBandBox=function(){if(this.rubberBandBox==null){this.rubberBandBox=this.selectorParentGroup.appendChild(c({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}))}return this.rubberBandBox};this.initGroup()}var U={};var H=function(bf){this._elem=bf||null;this._xforms=[];this._update=function(){var bi="";var bh=G.createSVGMatrix();for(var bj=0;bj<this.numberOfItems;++bj){var bg=this._list.getItem(bj);bi+=af(bg).text+" "}this._elem.setAttribute("transform",bi)};this._list=this;this._init=function(){var bp=this._elem.getAttribute("transform");if(!bp){return}var bt=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/;var bm=[];var bl=true;while(bl){bl=bp.match(bt);bp=bp.replace(bt,"");if(bl&&bl[1]){var bq=bl[1];var bs=bq.split(/\s*\(/);var bg=bs[0];var bk=bs[1].match(/\s*(.*?)\s*\)/);var bi=bk[1].split(/[, ]+/);var bn="abcdef".split("");var bh=G.createSVGMatrix();$.each(bi,function(bu,bv){bi[bu]=parseFloat(bv);if(bg=="matrix"){bh[bn[bu]]=bi[bu]}});var bo=G.createSVGTransform();var bj="set"+bg.charAt(0).toUpperCase()+bg.slice(1);var br=bg=="matrix"?[bh]:bi;bo[bj].apply(bo,br);this._list.appendItem(bo)}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(bg){this.numberOfItems=1;this._xforms=[bg]};this.getItem=function(bg){if(bg<this.numberOfItems&&bg>=0){return this._xforms[bg]}return null};this.insertItemBefore=function(bj,bh){var bl=null;if(bh>=0){if(bh<this.numberOfItems){var bk=new Array(this.numberOfItems+1);for(var bi=0;bi<bh;++bi){bk[bi]=this._xforms[bi]}bk[bi]=bj;for(var bg=bi+1;bi<this.numberOfItems;++bg,++bi){bk[bg]=this._xforms[bi]}this.numberOfItems++;this._xforms=bk;bl=bj;this._list._update()}else{bl=this._list.appendItem(bj)}}return bl};this.replaceItem=function(bh,bg){var bi=null;if(bg<this.numberOfItems&&bg>=0){this._xforms[bg]=bh;bi=bh;this._list._update()}return bi};this.removeItem=function(bh){var bk=null;if(bh<this.numberOfItems&&bh>=0){var bk=this._xforms[bh];var bj=new Array(this.numberOfItems-1);for(var bi=0;bi<bh;++bi){bj[bi]=this._xforms[bi]}for(var bg=bi;bg<this.numberOfItems-1;++bg,++bi){bj[bg]=this._xforms[bi+1]}this.numberOfItems--;this._xforms=bj;this._list._update()}return bk};this.appendItem=function(bg){this._xforms.push(bg);this.numberOfItems++;this._list._update();return bg}};var c=function(bf){return bb.updateElementFromJson(bf)};var bb=this,aI="http://www.w3.org/2000/svg",aC="http://www.w3.org/1999/xlink",X="http://www.w3.org/XML/1998/namespace",be="http://www.w3.org/2000/xmlns/",an="http://svg-edit.googlecode.com",O="http://www.w3.org/1999/xhtml",f="http://www.w3.org/1998/Math/MathML",aT="svg_",aK=aJ.ownerDocument,v=J.dimensions,G=aK.importNode(Utils.text2xml('<svg id="svgroot" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+v[0]+'" height="'+v[1]+'" x="'+v[0]+'" y="'+v[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,true);$(G).appendTo(aJ);var N=document.createElementNS(aI,"animate");$(N).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(G);var m=Math.floor(Math.random()*100001);var p=false;var ao={};ao[aC]="xlink";ao[X]="xml";ao[be]="xmlns";ao[an]="se";ao[O]="xhtml";ao[f]="mathml";var a9={};$.each(ao,function(bf,bg){a9[bg]=bf});var h={};$.each(aD,function(bf,bh){var bg={};$.each(bh,function(bk,bj){if(bj.indexOf(":")!=-1){var bi=bj.split(":");bg[bi[1]]=a9[bi[0]]}else{bg[bj]=bj=="xmlns"?be:null}});h[bf]=bg});var aj=aK.createElementNS(aI,"svg");$(aj).attr({id:"svgcontent",width:v[0],height:v[1],x:v[0],y:v[1],overflow:J.show_outside_canvas?"visible":"hidden",xmlns:aI,"xmlns:se":an,"xmlns:xlink":aC}).appendTo(G);if(p){aj.setAttributeNS(an,"se:nonce",m)}var a2,ap,ac;(function(){var bf=["x","x1","cx","rx","width"];var bg=["y","y1","cy","ry","height"];var bh=$.merge(["r","radius"],bf);$.merge(bh,bg);a2=function(bi,bm){if(!isNaN(bm)){return bm-0}if(bm.substr(-1)==="%"){var bj=bm.substr(0,bm.length-1)/100;var bk=bb.getResolution();if($.inArray(bi,bf)!==-1){return bj*bk.w}else{if($.inArray(bi,bg)!==-1){return bj*bk.h}else{return bj*Math.sqrt((bk.w*bk.w)+(bk.h*bk.h))/Math.sqrt(2)}}}else{var bl=bm.substr(-2);var bj=bm.substr(0,bm.length-2);return bj*I[bl]}};ac=function(bm,bi,bn){if(!isNaN(bn)){var bk=bm.getAttribute(bi);if(bk!==null&&isNaN(bk)){var bl;if(bk.substr(-1)==="%"){var bj=bb.getResolution();bl="%";bn*=100;if($.inArray(bi,bf)!==-1){bn=bn/bj.w}else{if($.inArray(bi,bg)!==-1){bn=bn/bj.h}else{return bn/Math.sqrt((bj.w*bj.w)+(bj.h*bj.h))/Math.sqrt(2)}}}else{bl=bk.substr(-2);bn=bn/I[bl]}bn+=bl}}bm.setAttribute(bi,bn)};bb.isValidUnit=function(bj,bn){var bl=false;if($.inArray(bj,bh)!=-1){if(!isNaN(bn)){bl=true}else{bn=bn.toLowerCase();$.each(I,function(bp){if(bl){return}var bo=new RegExp("^-?[\\d\\.]+"+bp+"$");if(bo.test(bn)){bl=true}})}}else{if(bj=="id"){var bi=false;try{var bk=b(bn);bi=(bk==null)}catch(bm){}return bi}else{bl=true}}return bl}})();var ax=function(bk,bh,bg,bf){if(!bg){bg=0}var bl=null;if(!window.opera){G.suspendRedraw(bg)}for(var bi in bh){var bj=(bi.substr(0,4)=="xml:"?X:bi.substr(0,6)=="xlink:"?aC:null);if(bj||!bf){bk.setAttributeNS(bj,bi,bh[bi])}else{ac(bk,bi,bh[bi])}}if(!window.opera){G.unsuspendRedraw(bl)}};var ar=function(bg){var bh=G.suspendRedraw(60);var bi={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};for(var bf in bi){var bj=bi[bf];if(bg.getAttribute(bf)==bj){bg.removeAttribute(bf)}}G.unsuspendRedraw(bh)};this.updateElementFromJson=function(bg){var bf=b(bg.attr.id);if(bf&&bg.element!=bf.tagName){W.removeChild(bf);bf=null}if(!bf){bf=aK.createElementNS(aI,bg.element);if(W){W.appendChild(bf)}}if(bg.curStyles){ax(bf,{fill:aL.fill,stroke:aL.stroke,"stroke-width":aL.stroke_width,"stroke-dasharray":aL.stroke_dasharray,"stroke-linejoin":aL.stroke_linejoin,"stroke-linecap":aL.stroke_linecap,"stroke-opacity":aL.stroke_opacity,"fill-opacity":aL.fill_opacity,opacity:aL.opacity/2,style:"pointer-events:inherit"},100)}ax(bf,bg.attr,100);ar(bf);return bf};(function(){var bf=aK.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");aj.appendChild(bf)})();var aP=[],aX={},ae=J.imgPath+"logo.png",W=null,ai={round_digits:5},aE=false,a4=1,ak=null,a1="select",ab="none",V={shape:{fill:"#"+J.initFill.color,fill_paint:null,fill_opacity:J.initFill.opacity,stroke:"#"+J.initStroke.color,stroke_paint:null,stroke_opacity:J.initStroke.opacity,stroke_width:J.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:J.initOpacity}};V.text=$.extend(true,{},V.shape);$.extend(V.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});var aL=V.shape,a5=V.text,q=aL,ad=1,aO=new Array(1),t=new Array(1),K=null,F=new bc(),j=null,D={},aM=0,T=[],aF=[],e={};var aG=this.runExtensions=function(bg,bi,bh){var bf=false;if(bh){bf=[]}$.each(e,function(bj,bk){if(bg in bk){if(bh){bf.push(bk[bg](bi))}else{bf=bk[bg](bi)}}});return bf};var Q=function(bf){return parseInt(bf*ad)/ad};var aV=function(bi){if(j==null){return null}if(!aF.length){aF=bb.getVisibleElements(W,true)}var bf=null;try{bf=W.getIntersectionList(bi,null)}catch(bj){}if(bf==null||typeof(bf.item)!="function"){bf=[];var bh=j.getBBox();$.each(bh,function(bk,bl){bh[bk]=bl/ad});var bg=aF.length;while(bg--){if(!bh.width||!bh.width){continue}if(Utils.rectsIntersect(bh,aF[bg].bbox)){bf.push(aF[bg].elem)}}}return bf};var aQ=function(bf){if(aM<T.length&&T.length>0){T=T.splice(0,aM)}T.push(bf);aM=T.length};this.getHistoryPosition=function(){return aM};var A=function(){if(D.getid){return ah("getid",a4)}if(p){return aT+m+"_"+a4}else{return aT+a4}};var a6=function(){var bf=A();while(b(bf)){a4++;bf=A()}return bf};var ah=function(bg,bf){if(D[bg]){return D[bg](this,bf)}};var M=function(bk){if(bk.nodeType==3){bk.nodeValue=bk.nodeValue.replace(/^\s+|\s+$/g,"");if(!bk.nodeValue.length){bk.parentNode.removeChild(bk)}}if(bk.nodeType!=1){return}var bs=bk.ownerDocument;var bt=bk.parentNode;if(!bs||!bt){return}var bp=aD[bk.nodeName];var bj=h[bk.nodeName];if(bp!=undefined){var bi=[];var bl=bk.attributes.length;while(bl--){var bo=bk.attributes.item(bl);var br=bo.nodeName;var bm=bo.localName;var bu=bo.namespaceURI;if(!(bj.hasOwnProperty(bm)&&bu==bj[bm]&&bu!=be)&&!(bu==be&&ao[bo.nodeValue])){if(br.indexOf("se:")==0){bi.push([br,bo.nodeValue])}bk.removeAttributeNS(bu,bm)}if(bk.nodeName=="path"&&br=="d"){bk.setAttribute("d",w.convertPath(bk));w.fixEnd(bk)}if(br=="style"){var bq=bo.nodeValue.split(";"),bg=bq.length;while(bg--){var bn=bq[bg].split(":");if(bp.indexOf(bn[0])!=-1){bk.setAttribute(bn[0],bn[1])}}bk.removeAttribute("style")}}$.each(bi,function(bw,bv){bk.setAttributeNS(an,bv[0],bv[1])});var bf=bk.getAttributeNS(aC,"href");if(bf&&$.inArray(bk.nodeName,["filter","linearGradient","pattern","radialGradient","textPath","use"])!=-1){if(bf[0]!="#"){bk.setAttributeNS(aC,"xlink:href","");bk.removeAttributeNS(aC,"href")}}if(bk.nodeName=="use"&&!bk.getAttributeNS(aC,"href")){bt.removeChild(bk);return}$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(bw,bv){var bx=bk.getAttribute(bv);if(bx){bx=am(bx);if(bx&&bx[0]!="#"){bk.setAttribute(bv,"");bk.removeAttribute(bv)}}});bl=bk.childNodes.length;while(bl--){M(bk.childNodes.item(bl))}}else{var bh=[];while(bk.hasChildNodes()){bh.push(bt.insertBefore(bk.firstChild,bk))}bt.removeChild(bk);var bl=bh.length;while(bl--){M(bh[bl])}}};this.getUrlFromAttr=function(bf){if(bf){if(bf.indexOf('url("')==0){return bf.substring(5,bf.indexOf('"',6))}else{if(bf.indexOf("url('")==0){return bf.substring(5,bf.indexOf("'",6))}else{if(bf.indexOf("url(")==0){return bf.substring(4,bf.indexOf(")"))}}}}return null};var am=this.getUrlFromAttr;var u=function(){var bo=aj.getElementsByTagNameNS(aI,"defs");if(!bo||!bo.length){return 0}var bs=[],bq=0;var bt=["fill","stroke","filter","marker-start","marker-mid","marker-end"];var bm=bt.length;var bu=aj.getElementsByTagNameNS(aI,"*");var bh=bu.length;for(var bp=0;bp<bh;bp++){var bj=bu[bp];for(var bn=0;bn<bm;bn++){var bk=am(bj.getAttribute(bt[bn]));if(bk){bs.push(bk.substr(1))}}var bf=bj.getAttributeNS(aC,"href");if(bf&&bf.indexOf("#")==0){bs.push(bf.substr(1))}}var bl=$(aj).find("linearGradient, radialGradient, filter, marker");defelem_ids=[],bp=bl.length;while(bp--){var br=bl[bp];var bg=br.id;if($.inArray(bg,bs)==-1){br.parentNode.removeChild(br);bq++}}var bp=bo.length;while(bp--){var bi=bo[bp];if(!bi.getElementsByTagNameNS(aI,"*").length){bi.parentNode.removeChild(bi)}}return bq};var i=function(){while(u()>0){}w.clear(true);$.each(aj.childNodes,function(bg,bh){if(bg&&bh.nodeType==8&&bh.data.indexOf("Created with")!=-1){aj.insertBefore(bh,aj.firstChild)}});var bf=aS(aj,0);return bf};var aS=function(bh,bg){var bi=new Array();if(bh){ar(bh);var bs=bh.attributes,bo,bk,bp=bh.childNodes;for(var bk=0;bk<bg;bk++){bi.push(" ")}bi.push("<");bi.push(bh.nodeName);if(bh.id=="svgcontent"){var bq=bb.getResolution();bi.push(' width="'+bq.w+'" height="'+bq.h+'" xmlns="'+aI+'"');var bl={};$(bh).find("*").andSelf().each(function(){var bt=this;$.each(this.attributes,function(bv,bu){var bw=bu.namespaceURI;if(bw&&!bl[bw]&&ao[bw]!=="xmlns"&&ao[bw]!=="xml"){bl[bw]=true;bi.push(" xmlns:"+ao[bw]+'="'+bw+'"')}})});var bk=bs.length;while(bk--){bo=bs.item(bk);var bn=d(bo.nodeValue);if(bo.nodeName.indexOf("xmlns:")===0){continue}if(bn!=""&&$.inArray(bo.localName,["width","height","xmlns","x","y","viewBox","id","overflow"])==-1){if(!bo.namespaceURI||ao[bo.namespaceURI]){bi.push(" ");bi.push(bo.nodeName);bi.push('="');bi.push(bn);bi.push('"')}}}}else{for(var bk=bs.length-1;bk>=0;bk--){bo=bs.item(bk);var bn=d(bo.nodeValue);if($.inArray(bo.localName,["-moz-math-font-style","_moz-math-font-style"])!==-1){continue}if(bn!=""){if(bn.indexOf("pointer-events")==0){continue}if(bo.localName=="class"&&bn.indexOf("se_")==0){continue}bi.push(" ");if(bo.localName=="d"){bn=w.convertPath(bh,true)}if(!isNaN(bn)){bn=a3(bn)}if(ai.apply&&bh.nodeName=="image"&&bo.localName=="href"&&ai.images&&ai.images=="embed"){var bj=aX[bn];if(bj){bn=bj}}if(!bo.namespaceURI||bo.namespaceURI==aI||ao[bo.namespaceURI]){bi.push(bo.nodeName);bi.push('="');bi.push(bn);bi.push('"')}}}}if(bh.hasChildNodes()){bi.push(">");bg++;var bm=false;for(var bk=0;bk<bp.length;bk++){var bf=bp.item(bk);switch(bf.nodeType){case 1:bi.push("\n");bi.push(aS(bp.item(bk),bg));break;case 3:var br=bf.nodeValue.replace(/^\s+|\s+$/g,"");if(br!=""){bm=true;bi.push(d(br)+"")}break;case 8:bi.push("\n");bi.push(new Array(bg+1).join(" "));bi.push("<!--");bi.push(bf.data);bi.push("-->");break}}bg--;if(!bm){bi.push("\n");for(var bk=0;bk<bg;bk++){bi.push(" ")}}bi.push("</");bi.push(bh.nodeName);bi.push(">")}else{bi.push("/>")}}return bi.join("")};this.embedImage=function(bf,bg){$(new Image()).load(function(){var bh=document.createElement("canvas");bh.width=this.width;bh.height=this.height;bh.getContext("2d").drawImage(this,0,0);try{var bi=";svgedit_url="+encodeURIComponent(bf);bi=bh.toDataURL().replace(";base64",bi+";base64");aX[bf]=bi}catch(bj){aX[bf]=false}ae=bf;if(bg){bg(aX[bf])}}).attr("src",bf)};this.fixOperaXML=function(bi,bg){var bh=bi.attributes;$.each(bh,function(bl,bk){if(bk.nodeValue.indexOf(",")==-1){return}var bn=bk.prefix=="xlink"?aC:bk.prefix=="xml"?X:null;var bm=bg.getAttribute(bk.localName);if(bn){bi.setAttributeNS(bn,bk.nodeName,bm)}else{bi.setAttribute(bk.nodeName,bm)}});var bj=bi.childNodes;var bf=bg.childNodes;$.each(bj,function(bk,bl){if(bl.nodeType==1){bb.fixOperaXML(bl,bf[bk])}})};var aY=function(){var bj=(ab=="none"?"position":"size");var bf=new ay(bj);var bg=aO.length;while(bg--){var bh=aO[bg];var bi=l(bh);if(bi){bf.addSubCommand(bi)}}if(!bf.isEmpty()){aQ(bf);ah("changed",aO)}};var E=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"];var av=function(bf){console.log([bf.a,bf.b,bf.c,bf.d,bf.e,bf.f])};var B=function(bu,bH,bx){var bk=function(bI,bJ){return P(bI,bJ,bx)},bj=function(bI){return bx.a*bI},bs=function(bI){return bx.d*bI},bp=bb.getBBox(bu);switch(bu.tagName){case"line":var bn=bk(bH.x1,bH.y1),bm=bk(bH.x2,bH.y2);bH.x1=bn.x;bH.y1=bn.y;bH.x2=bm.x;bH.y2=bm.y;break;case"circle":var bG=bk(bH.cx,bH.cy);bH.cx=bG.x;bH.cy=bG.y;var bA=bd(bp.x,bp.y,bp.width,bp.height,bx);var bq=bA.tr.x-bA.tl.x,bE=bA.bl.y-bA.tl.y;bH.r=Math.min(bq/2,bE/2);break;case"ellipse":var bG=bk(bH.cx,bH.cy);bH.cx=bG.x;bH.cy=bG.y;bH.rx=bj(bH.rx);bH.ry=bs(bH.ry);break;case"foreignObject":case"rect":case"image":var bn=bk(bH.x,bH.y);bH.x=bn.x;bH.y=bn.y;bH.width=bj(bH.width);bH.height=bs(bH.height);break;case"use":var bn=bk(bH.x,bH.y);bH.x=bn.x;bH.y=bn.y;break;case"text":if(bx.a==1&&bx.b==0&&bx.c==0&&bx.d==1&&(bx.e!=0||bx.f!=0)){var bt=r(bu).matrix,bo=ag(bt.inverse(),bx,bt);bH.x=parseFloat(bH.x)+bo.e;bH.y=parseFloat(bH.y)+bo.f}else{var bg=bb.getTransformList(bu);var bv=G.createSVGTransform();bv.setMatrix(ag(r(bg).matrix,bx));bg.clear();bg.appendItem(bv)}break;case"polygon":case"polyline":var bD=bH.points.length;for(var bC=0;bC<bD;++bC){var bw=bH.points[bC];bw=bk(bw.x,bw.y);bH.points[bC].x=bw.x;bH.points[bC].y=bw.y}break;case"path":var bf=bu.pathSegList;var bD=bf.numberOfItems;bH.d=new Array(bD);for(var bC=0;bC<bD;++bC){var bF=bf.getItem(bC);bH.d[bC]={type:bF.pathSegType,x:bF.x,y:bF.y,x1:bF.x1,y1:bF.y1,x2:bF.x2,y2:bF.y2,r1:bF.r1,r2:bF.r2,angle:bF.angle,largeArcFlag:bF.largeArcFlag,sweepFlag:bF.sweepFlag}}var bD=bH.d.length,bi=bH.d[0],by=bk(bi.x,bi.y);bH.d[0].x=by.x;bH.d[0].y=by.y;for(var bC=1;bC<bD;++bC){var bF=bH.d[bC];var bh=bF.type;if(bh%2==0){var bB=(bF.x!=undefined)?bF.x:by.x,bz=(bF.y!=undefined)?bF.y:by.y,bw=bk(bB,bz),bn=bk(bF.x1,bF.y1),bm=bk(bF.x2,bF.y2);bF.x=bw.x;bF.y=bw.y;bF.x1=bn.x;bF.y1=bn.y;bF.x2=bm.x;bF.y2=bm.y;bF.r1=bj(bF.r1),bF.r2=bs(bF.r2)}else{bF.x=bj(bF.x);bF.y=bs(bF.y);bF.x1=bj(bF.x1);bF.y1=bs(bF.y1);bF.x2=bj(bF.x2);bF.y2=bs(bF.y2);bF.r1=bj(bF.r1),bF.r2=bs(bF.r2)}if(bF.x){by.x=bF.x}if(bF.y){by.y=bF.y}}break}switch(bu.tagName){case"foreignObject":case"rect":case"image":bH.x=bH.x-0+Math.min(0,bH.width);bH.y=bH.y-0+Math.min(0,bH.height);bH.width=Math.abs(bH.width);bH.height=Math.abs(bH.height);ax(bu,bH,1000,true);break;case"use":ax(bu,bH,1000,true);break;case"ellipse":bH.rx=Math.abs(bH.rx);bH.ry=Math.abs(bH.ry);case"circle":if(bH.r){bH.r=Math.abs(bH.r)}case"line":case"text":ax(bu,bH,1000,true);break;case"polyline":case"polygon":var bD=bH.points.length;var bl="";for(var bC=0;bC<bD;++bC){var bw=bH.points[bC];bl+=bw.x+","+bw.y+" "}bu.setAttribute("points",bl);break;case"path":var br="";var bD=bH.d.length;for(var bC=0;bC<bD;++bC){var bF=bH.d[bC];var bh=bF.type;br+=E[bh];switch(bh){case 13:case 12:br+=bF.x+" ";break;case 15:case 14:br+=bF.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:br+=bF.x+","+bF.y+" ";break;case 7:case 6:br+=bF.x1+","+bF.y1+" "+bF.x2+","+bF.y2+" "+bF.x+","+bF.y+" ";break;case 9:case 8:br+=bF.x1+","+bF.y1+" "+bF.x+","+bF.y+" ";break;case 11:case 10:br+=bF.r1+","+bF.r2+" "+bF.angle+" "+Number(bF.largeArcFlag)+" "+Number(bF.sweepFlag)+" "+bF.x+","+bF.y+" ";break;case 17:case 16:br+=bF.x2+","+bF.y2+" "+bF.x+","+bF.y+" ";break}}bu.setAttribute("d",br);break}};var l=function(bH){if(bH==null){return null}var bP=bb.getTransformList(bH);if(bP&&bP.numberOfItems>0){var b8=bP.numberOfItems;while(b8--){var bX=bP.getItem(b8);if(bX.type==0){bP.removeItem(b8)}else{if(bX.type==1){if(a8(bX.matrix)){bP.removeItem(b8)}}else{if(bX.type==4){if(bX.angle==0){bP.removeItem(b8)}}}}}if(bP.numberOfItems==1&&bb.getRotationAngle(bH)){return null}}if(!bP||bP.numberOfItems==0){bH.removeAttribute("transform");return null}var bg=new ay("Transform");var bB={},cg=null,bp=[];switch(bH.tagName){case"line":bp=["x1","y1","x2","y2"];break;case"circle":bp=["cx","cy","r"];break;case"ellipse":bp=["cx","cy","rx","ry"];break;case"foreignObject":case"rect":case"image":bp=["width","height","x","y"];break;case"use":bp=["x","y"];break;case"text":bp=["x","y"];break;case"polygon":case"polyline":cg={};cg.points=bH.getAttribute("points");var bA=bH.points;var by=bA.numberOfItems;bB.points=new Array(by);for(var cb=0;cb<by;++cb){var bq=bA.getItem(cb);bB.points[cb]={x:bq.x,y:bq.y}}break;case"path":cg={};cg.d=bH.getAttribute("d");bB.d=bH.getAttribute("d");break}if(bp.length){bB=$(bH).attr(bp);$.each(bB,function(cl,cm){bB[cl]=a2(cl,cm)})}if(cg==null){cg=$.extend(true,{},bB);$.each(cg,function(cl,cm){cg[cl]=a2(cl,cm)})}cg.transform=ak?ak:"";if(bH.tagName=="g"||bH.tagName=="a"){var bl=bb.getBBox(bH),cj={x:bl.x+bl.width/2,y:bl.y+bl.height/2},bi=P(bl.x+bl.width/2,bl.y+bl.height/2,r(bP).matrix),b2=G.createSVGMatrix();var bF=bb.getRotationAngle(bH);if(bF){var ch=bF*Math.PI/180;if(Math.abs(ch)>(1e-10)){var bU=Math.sin(ch)/(1-Math.cos(ch))}else{var bU=2/ch}for(var cb=0;cb<bP.numberOfItems;++cb){var bX=bP.getItem(cb);if(bX.type==4){var bN=bX.matrix;cj.y=(bU*bN.e+bN.f)/2;cj.x=(bN.e-bU*bN.f)/2;bP.removeItem(cb);break}}}var b9=0,b7=0,bO=0,bn=bP.numberOfItems;if(bn){var b6=bP.getItem(0).matrix}if(bn>=3&&bP.getItem(bn-2).type==3&&bP.getItem(bn-3).type==2&&bP.getItem(bn-1).type==2){bO=3;var ck=bP.getItem(bn-3).matrix,bs=bP.getItem(bn-2).matrix,b0=bP.getItem(bn-1).matrix;var bv=bH.childNodes;var cf=bv.length;while(cf--){var bk=bv.item(cf);b9=0;b7=0;if(bk.nodeType==1){var bz=bb.getTransformList(bk);if(!bz){continue}var b2=r(bz).matrix;var bx=bb.getRotationAngle(bk);var bT=ak;var b3=[];ak=bk.getAttribute("transform");if(bx||aN(bz)){var bS=G.createSVGTransform();bS.setMatrix(ag(ck,bs,b0,b2));bz.clear();bz.appendItem(bS);b3.push(bS)}else{var bj=ag(b2.inverse(),b0,b2);var bJ=G.createSVGMatrix();bJ.e=-bj.e;bJ.f=-bj.f;var ce=ag(bJ.inverse(),b2.inverse(),ck,bs,b0,b2,bj.inverse());var ci=G.createSVGTransform(),bL=G.createSVGTransform(),br=G.createSVGTransform();ci.setTranslate(bj.e,bj.f);bL.setScale(ce.a,ce.d);br.setTranslate(bJ.e,bJ.f);bz.appendItem(br);bz.appendItem(bL);bz.appendItem(ci);b3.push(br);b3.push(bL);b3.push(ci);av(br.matrix);av(bL.matrix)}bg.addSubCommand(l(bk));ak=bT}}bP.removeItem(bn-1);bP.removeItem(bn-2);bP.removeItem(bn-3)}else{if(bn>=3&&bP.getItem(bn-1).type==1){bO=3;b2=r(bP).matrix;var bS=G.createSVGTransform();bS.setMatrix(b2);bP.clear();bP.appendItem(bS)}else{if((bn==1||(bn>1&&bP.getItem(1).type!=3))&&bP.getItem(0).type==2){bO=2;var bE=r(bP).matrix;bP.removeItem(0);var bK=r(bP).matrix.inverse();var bu=ag(bK,bE);b9=bu.e;b7=bu.f;if(b9!=0||b7!=0){var bv=bH.childNodes;var cf=bv.length;while(cf--){var bk=bv.item(cf);if(bk.nodeType==1){var bT=ak;ak=bk.getAttribute("transform");var bz=bb.getTransformList(bk);if(bz){var bI=G.createSVGTransform();bI.setTranslate(b9,b7);bz.insertItemBefore(bI,0);bg.addSubCommand(l(bk));var bG=bH.getElementsByTagNameNS(aI,"use");var bD="#"+bk.id;var bR=bG.length;while(bR--){var bQ=bG.item(bR);if(bD==bQ.getAttributeNS(aC,"href")){var cc=G.createSVGTransform();cc.setTranslate(-b9,-b7);bb.getTransformList(bQ).insertItemBefore(cc,0);bg.addSubCommand(l(bQ))}}ak=bT}}}ak=bT}}else{if(bn==1&&bP.getItem(0).type==1&&!bF){bO=1;var b2=bP.getItem(0).matrix,bv=bH.childNodes,cf=bv.length;while(cf--){var bk=bv.item(cf);if(bk.nodeType==1){var bT=ak;ak=bk.getAttribute("transform");var bz=bb.getTransformList(bk);var ca=ag(b2,r(bz).matrix);var bZ=G.createSVGTransform();bZ.setMatrix(ca);bz.clear();bz.appendItem(bZ,0);bg.addSubCommand(l(bk));ak=bT}}bP.clear()}else{if(bF){var bh=G.createSVGTransform();bh.setRotate(bF,bi.x,bi.y);bP.insertItemBefore(bh,0)}if(bP.numberOfItems==0){bH.removeAttribute("transform")}return null}}}}if(bO==2){if(bF){bi={x:cj.x+b6.e,y:cj.y+b6.f};var bh=G.createSVGTransform();bh.setRotate(bF,bi.x,bi.y);bP.insertItemBefore(bh,0)}}else{if(bO==3){var b2=r(bP).matrix;var bf=G.createSVGTransform();bf.setRotate(bF,cj.x,cj.y);var bM=bf.matrix;var b1=G.createSVGTransform();b1.setRotate(bF,bi.x,bi.y);var bC=b1.matrix.inverse(),b5=b2.inverse(),bW=ag(b5,bC,bM,b2);b9=bW.e;b7=bW.f;if(b9!=0||b7!=0){var bv=bH.childNodes;var cf=bv.length;while(cf--){var bk=bv.item(cf);if(bk.nodeType==1){var bT=ak;ak=bk.getAttribute("transform");var bz=bb.getTransformList(bk);var bI=G.createSVGTransform();bI.setTranslate(b9,b7);bz.insertItemBefore(bI,0);bg.addSubCommand(l(bk));ak=bT}}}if(bF){bP.insertItemBefore(b1,0)}}}}else{var bl=bb.getBBox(bH);if(!bl){return null}var cj={x:bl.x+bl.width/2,y:bl.y+bl.height/2},bi=P(bl.x+bl.width/2,bl.y+bl.height/2,r(bP).matrix),b2=G.createSVGMatrix(),bx=bb.getRotationAngle(bH);if(bx){var ch=bx*Math.PI/180;if(Math.abs(ch)>(1e-10)){var bU=Math.sin(ch)/(1-Math.cos(ch))}else{var bU=2/ch}for(var cb=0;cb<bP.numberOfItems;++cb){var bX=bP.getItem(cb);if(bX.type==4){var bN=bX.matrix;cj.y=(bU*bN.e+bN.f)/2;cj.x=(bN.e-bU*bN.f)/2;bP.removeItem(cb);break}}}var bO=0;var bn=bP.numberOfItems;if(!aA){var bt=bH.getAttribute("fill");if(bt&&bt.indexOf("url(")===0){var bw=b(am(bt).substr(1));if(bw.getAttribute("gradientUnits")==="userSpaceOnUse"){var bw=$(bw);b2=r(bP).matrix;var bY=bb.getTransformList(bw[0]);var b4=r(bY).matrix;b2=ag(b2,b4);var bV="matrix("+[b2.a,b2.b,b2.c,b2.d,b2.e,b2.f].join(",")+")";bw.attr("gradientTransform",bV)}}}if(bn>=3&&bP.getItem(bn-2).type==3&&bP.getItem(bn-3).type==2&&bP.getItem(bn-1).type==2&&bH.nodeName!="use"){bO=3;b2=r(bP,bn-3,bn-1).matrix;bP.removeItem(bn-1);bP.removeItem(bn-2);bP.removeItem(bn-3)}else{if(bn==4&&bP.getItem(bn-1).type==1){bO=3;b2=r(bP).matrix;var bS=G.createSVGTransform();bS.setMatrix(b2);bP.clear();bP.appendItem(bS);b2=G.createSVGMatrix()}else{if((bn==1||(bn>1&&bP.getItem(1).type!=3))&&bP.getItem(0).type==2){bO=2;var cd=bP.getItem(0).matrix,bo=r(bP,1).matrix,bm=bo.inverse();b2=ag(bm,cd,bo);bP.removeItem(0)}else{if(bn==1&&bP.getItem(0).type==1&&!bx){b2=r(bP).matrix;switch(bH.tagName){case"line":bB=$(bH).attr(["x1","y1","x2","y2"]);case"polyline":case"polygon":bB.points=bH.getAttribute("points");if(bB.points){var bA=bH.points;var by=bA.numberOfItems;bB.points=new Array(by);for(var cb=0;cb<by;++cb){var bq=bA.getItem(cb);bB.points[cb]={x:bq.x,y:bq.y}}}case"path":bB.d=bH.getAttribute("d");bO=1;bP.clear();break;default:break}}else{bO=4;if(bx){var bh=G.createSVGTransform();bh.setRotate(bx,bi.x,bi.y);bP.insertItemBefore(bh,0)}if(bP.numberOfItems==0){bH.removeAttribute("transform")}return null}}}}if(bO==1||bO==2||bO==3){B(bH,bB,b2)}if(bO==2){if(bx){bi={x:cj.x+b2.e,y:cj.y+b2.f};var bh=G.createSVGTransform();bh.setRotate(bx,bi.x,bi.y);bP.insertItemBefore(bh,0)}}else{if(bO==3){var b2=r(bP).matrix;var bf=G.createSVGTransform();bf.setRotate(bx,cj.x,cj.y);var bM=bf.matrix;var b1=G.createSVGTransform();b1.setRotate(bx,bi.x,bi.y);var bC=b1.matrix.inverse();var b5=b2.inverse();var bW=ag(b5,bC,bM,b2);B(bH,bB,bW);if(bx){bP.insertItemBefore(b1,0)}}}}if(bP.numberOfItems==0){bH.removeAttribute("transform")}bg.addSubCommand(new au(bH,cg));return bg};this.clearSelection=function(bi){if(aO[0]!=null){var bf=aO.length;for(var bg=0;bg<bf;++bg){var bh=aO[bg];if(bh==null){break}F.releaseSelector(bh);aO[bg]=null}t[0]=null}if(!bi){ah("selected",aO)}};this.addToSelection=function(bf,bj){if(bf.length==0){return}var bg=0;while(bg<aO.length){if(aO[bg]==null){break}++bg}var bh=bf.length;while(bh--){var bi=bf[bh];if(!bi||!this.getBBox(bi)){continue}if(aO.indexOf(bi)==-1){aO[bg]=bi;if(bg==0){t[bg]=this.getBBox(bi)}bg++;var bk=F.requestSelector(bi);if(aO.length>1){bk.showGrips(false)}}}if(aO[0]&&aO.length===1&&aO[0].tagName=="a"){aO[0]=aO[0].firstChild}ah("selected",aO);if(bj||aO.length==1){F.requestSelector(aO[0]).showGrips(true)}else{F.requestSelector(aO[0]).showGrips(false)}aO.sort(function(bm,bl){if(bm&&bl&&bm.compareDocumentPosition){return 3-(bl.compareDocumentPosition(bm)&6)}else{if(bm==null){return 1}}});while(aO[0]==null){aO.shift(0)}};this.removeFromSelection=function(bg){if(aO[0]==null){return}if(bg.length==0){return}var bj=new Array(aO.length),bl=new Array(t.length),bh=0,bf=aO.length;for(var bi=0;bi<bf;++bi){var bk=aO[bi];if(bk){if(bg.indexOf(bk)==-1){bj[bh]=bk;if(bh==0){bl[bh]=t[bi]}bh++}else{F.releaseSelector(bk)}}}aO=bj;t=bl};var o=null;var P=function(bg,bh,bf){return{x:bf.a*bg+bf.c*bh+bf.e,y:bf.b*bg+bf.d*bh+bf.f}};var a8=function(bf){return(bf.a==1&&bf.b==0&&bf.c==0&&bf.d==1&&bf.e==0&&bf.f==0)};this.smoothControlPoints=function(bf,bv,bu){var bh=bf.x-bu.x,bt=bf.y-bu.y,bg=bv.x-bu.x,br=bv.y-bu.y;if((bh!=0||bt!=0)&&(bg!=0||br!=0)){var bn=Math.atan2(bt,bh),bm=Math.atan2(br,bg),bj=Math.sqrt(bh*bh+bt*bt),bi=Math.sqrt(bg*bg+br*br),bl=G.createSVGPoint(),bk=G.createSVGPoint();if(bn<0){bn+=2*Math.PI}if(bm<0){bm+=2*Math.PI}var bs=Math.abs(bn-bm),bp=Math.abs(Math.PI-bs)/2;var bq,bo;if(bn-bm>0){bq=bs<Math.PI?(bn+bp):(bn-bp);bo=bs<Math.PI?(bm-bp):(bm+bp)}else{bq=bs<Math.PI?(bn-bp):(bn+bp);bo=bs<Math.PI?(bm+bp):(bm-bp)}bl.x=bj*Math.cos(bq)+bu.x;bl.y=bj*Math.sin(bq)+bu.y;bk.x=bi*Math.cos(bo)+bu.x;bk.y=bi*Math.sin(bo)+bu.y;return[bl,bk]}return undefined};var Y=this.smoothControlPoints;this.matrixMultiply=function(){var bg=1e-14,bk=function(bn,bm){var bl=G.createSVGMatrix();bl.a=bn.a*bm.a+bn.c*bm.b;bl.b=bn.b*bm.a+bn.d*bm.b,bl.c=bn.a*bm.c+bn.c*bm.d,bl.d=bn.b*bm.c+bn.d*bm.d,bl.e=bn.a*bm.e+bn.c*bm.f+bn.e,bl.f=bn.b*bm.e+bn.d*bm.f+bn.f;return bl},bi=arguments,bj=bi.length,bf=bi[bj-1];while(bj-->1){var bh=bi[bj-1];bf=bk(bh,bf)}if(Math.abs(bf.a)<bg){bf.a=0}if(Math.abs(bf.b)<bg){bf.b=0}if(Math.abs(bf.c)<bg){bf.c=0}if(Math.abs(bf.d)<bg){bf.d=0}if(Math.abs(bf.e)<bg){bf.e=0}if(Math.abs(bf.f)<bg){bf.f=0}return bf};var ag=this.matrixMultiply;var r=function(bl,bk,bg){var bk=bk==undefined?0:bk;var bg=bg==undefined?(bl.numberOfItems-1):bg;bk=parseInt(bk);bg=parseInt(bg);if(bk>bg){var bh=bg;bg=bk;bk=bh}var bf=G.createSVGMatrix();for(var bj=bk;bj<=bg;++bj){var bi=(bj>=0&&bj<bl.numberOfItems?bl.getItem(bj).matrix:G.createSVGMatrix());bf=ag(bf,bi)}return G.createSVGTransformFromMatrix(bf)};var aN=function(bh){if(!bh){return false}var bg=bh.numberOfItems;while(bg--){var bf=bh.getItem(bg);if(bf.type==1&&!a8(bf.matrix)){return true}}return false};var z=function(bf){var bg=bb.getTransformList(bf);return r(bg).matrix};var af=function(bg,bj){var bf=bg.matrix,bi={tx:0,ty:0,sx:1,sy:1,angle:0,cx:0,cy:0,text:""},bk=bj?ad:1;switch(bg.type){case 1:bi.text="matrix("+[bf.a,bf.b,bf.c,bf.d,bf.e,bf.f].join(",")+")";break;case 2:bi.tx=bf.e;bi.ty=bf.f;bi.text="translate("+bf.e*bk+","+bf.f*bk+")";break;case 3:bi.sx=bf.a;bi.sy=bf.d;if(bf.a==bf.d){bi.text="scale("+bf.a+")"}else{bi.text="scale("+bf.a+","+bf.d+")"}break;case 4:bi.angle=bg.angle;if(bg.angle!=0){var bh=1-bf.a;bi.cy=(bh*bf.f+bf.b*bf.e)/(bh*bh+bf.b*bf.b);bi.cx=(bf.e-bf.b*bi.cy)/bh}bi.text="rotate("+bg.angle+" "+bi.cx*bk+","+bi.cy*bk+")";break}return bi};var bd=function(bh,br,bo,bi,bg){var bk={x:bh,y:br},bl={x:(bh+bo),y:br},bf={x:(bh+bo),y:(br+bi)},bj={x:bh,y:(br+bi)};bk=P(bk.x,bk.y,bg);var bq=bk.x,bn=bk.x,bp=bk.y,bm=bk.y;bl=P(bl.x,bl.y,bg);bq=Math.min(bq,bl.x);bn=Math.max(bn,bl.x);bp=Math.min(bp,bl.y);bm=Math.max(bm,bl.y);bj=P(bj.x,bj.y,bg);bq=Math.min(bq,bj.x);bn=Math.max(bn,bj.x);bp=Math.min(bp,bj.y);bm=Math.max(bm,bj.y);bf=P(bf.x,bf.y,bg);bq=Math.min(bq,bf.x);bn=Math.max(bn,bf.x);bp=Math.min(bp,bf.y);bm=Math.max(bm,bf.y);return{tl:bk,tr:bl,bl:bj,br:bf,aabox:{x:bq,y:bp,width:(bn-bq),height:(bm-bp)}}};var aa=function(bf){if(bf==null){return null}var bg=bf.target;if(bg.correspondingUseElement){bg=bg.correspondingUseElement}if($.inArray(bg.namespaceURI,[f,O])!=-1&&bg.id!="svgcanvas"){while(bg.nodeName!="foreignObject"){bg=bg.parentNode}}while(bg.parentNode.parentNode.tagName=="g"){bg=bg.parentNode}if(bg.nodeName.toLowerCase()=="div"){bg=G}return bg};(function(){var bf=null,bm=null,bl=null,bk={},bg={minx:null,miny:null,maxx:null,maxy:null};var bi=function(bD){if(bD.button===1||bb.spaceKey){return}o=aj.getScreenCTM().inverse();var bE=P(bD.pageX,bD.pageY,o),by=bE.x*ad,bx=bE.y*ad;bD.preventDefault();if($.inArray(a1,["select","resize"])==-1){C()}var bC=by/ad,bA=bx/ad,bp=aa(bD);bm=bC;bl=bA;if(bp.parentNode==F.selectorParentGroup&&aO[0]!=null){var bB=bD.target.id,bw=bB.substr(0,20);if(bw=="selectorGrip_rotate_"){a1="rotate"}else{if(bw=="selectorGrip_resize_"){a1="resize";ab=bB.substr(20,bB.indexOf("_",20)-20)}}bp=aO[0]}ak=bp.getAttribute("transform");var bt=bb.getTransformList(bp);switch(a1){case"select":aE=true;ab="none";if(bp!=G){if(aO.indexOf(bp)==-1){if(!bD.shiftKey){bb.clearSelection(true)}bb.addToSelection([bp]);K=bp;w.clear()}for(var br=0;br<aO.length;++br){if(aO[br]==null){continue}var bv=bb.getTransformList(aO[br]);bv.insertItemBefore(G.createSVGTransform(),0)}}else{bb.clearSelection();a1="multiselect";if(j==null){j=F.getRubberBandBox()}bm*=ad;bl*=ad;ax(j,{x:bm,y:bl,width:0,height:0,display:"inline"},100)}break;case"zoom":aE=true;bm=bC;bl=bA;if(j==null){j=F.getRubberBandBox()}ax(j,{x:bm*ad,y:bl*ad,width:0,height:0,display:"inline"},100);break;case"resize":aE=true;bm=bC;bl=bA;bk=bb.getBBox($("#selectedBox0")[0]);$.each(bk,function(bF,bG){bk[bF]=bG/ad});var bz=bb.getRotationAngle(bp)?1:0;if(aN(bt)){bt.insertItemBefore(G.createSVGTransform(),bz);bt.insertItemBefore(G.createSVGTransform(),bz);bt.insertItemBefore(G.createSVGTransform(),bz)}else{bt.appendItem(G.createSVGTransform());bt.appendItem(G.createSVGTransform());bt.appendItem(G.createSVGTransform())}break;case"fhellipse":case"fhrect":case"fhpath":aE=true;bm=bC;bl=bA;bf=bC+","+bA+" ";var bq=aL.stroke_width==0?1:aL.stroke_width;c({element:"polyline",curStyles:true,attr:{points:bf,id:a6(),fill:"none",opacity:aL.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});bg.minx=bC;bg.maxx=bC;bg.miny=bA;bg.maxy=bA;break;case"image":aE=true;bm=bC;bl=bA;var bu=c({element:"image",attr:{x:bC,y:bA,width:0,height:0,id:a6(),opacity:aL.opacity/2,style:"pointer-events:inherit"}});bu.setAttributeNS(aC,"xlink:href",ae);aU(bu);break;case"square":case"rect":aE=true;bm=bC;bl=bA;c({element:"rect",curStyles:true,attr:{x:bC,y:bA,width:0,height:0,id:a6(),opacity:aL.opacity/2}});break;case"line":aE=true;var bq=aL.stroke_width==0?1:aL.stroke_width;c({element:"line",curStyles:true,attr:{x1:bC,y1:bA,x2:bC,y2:bA,id:a6(),stroke:aL.stroke,"stroke-width":bq,"stroke-dasharray":aL.stroke_dasharray,"stroke-linejoin":aL.stroke_linejoin,"stroke-linecap":aL.stroke_linecap,"stroke-opacity":aL.stroke_opacity,fill:"none",opacity:aL.opacity/2,style:"pointer-events:none"}});break;case"circle":aE=true;c({element:"circle",curStyles:true,attr:{cx:bC,cy:bA,r:0,id:a6(),opacity:aL.opacity/2}});break;case"ellipse":aE=true;c({element:"ellipse",curStyles:true,attr:{cx:bC,cy:bA,rx:0,ry:0,id:a6(),opacity:aL.opacity/2}});break;case"text":aE=true;var bs=c({element:"text",curStyles:true,attr:{x:bC,y:bA,id:a6(),fill:a5.fill,"stroke-width":a5.stroke_width,"font-size":a5.font_size,"font-family":a5.font_family,"text-anchor":"middle","xml:space":"preserve"}});break;case"path":case"pathedit":bm*=ad;bl*=ad;w.mouseDown(bD,bp,bm,bl);aE=true;break;case"textedit":bm*=ad;bl*=ad;L.mouseDown(bD,bp,bm,bl);aE=true;break;case"rotate":aE=true;bb.beginUndoableChange("transform",aO);break;default:break}var bo=aG("mouseDown",{event:bD,start_x:bm,start_y:bl,selectedElements:aO},true);$.each(bo,function(bF,bG){if(bG&&bG.started){aE=true}})};var bn=function(bU){if(!aE){return}if(bU.button===1||bb.spaceKey){return}var bS=aO[0],bB=P(bU.pageX,bU.pageY,o),b1=bB.x*ad,b0=bB.y*ad,bM=b(A());x=b1/ad;y=b0/ad;bU.preventDefault();switch(a1){case"select":if(aO[0]!=null){var bt=x-bm;var bs=y-bl;if(bU.shiftKey){var bV=Utils.snapToAngle(bm,bl,x,y);x=bV.x;y=bV.y}if(bt!=0||bs!=0){var bK=aO.length;for(var b8=0;b8<bK;++b8){var bS=aO[b8];if(bS==null){break}if(b8==0){var bx=bb.getBBox(bS)}var b3=G.createSVGTransform();var bY=bb.getTransformList(bS);b3.setTranslate(bt,bs);if(bY.numberOfItems){bY.replaceItem(b3,0)}else{bY.appendItem(b3)}F.requestSelector(bS).resize()}}}break;case"multiselect":x*=ad;y*=ad;ax(j,{x:Math.min(bm,x),y:Math.min(bl,y),width:Math.abs(x-bm),height:Math.abs(y-bl)},100);var bT=[],b7=[],bu=aV(),bK=aO.length;for(var b8=0;b8<bK;++b8){var b9=bu.indexOf(aO[b8]);if(b9==-1){bT.push(aO[b8])}else{bu[b9]=null}}bK=bu.length;for(b8=0;b8<bK;++b8){if(bu[b8]){b7.push(bu[b8])}}if(bT.length>0){bb.removeFromSelection(bT)}if(b7.length>0){bb.addToSelection(b7)}break;case"resize":var bY=bb.getTransformList(bS),bC=aN(bY),bx=bC?bk:bb.getBBox(bS),bv=bx.x,bw=bx.y,bo=bx.width,bq=bx.height,bt=(x-bm),bs=(y-bl);var bJ=bb.getRotationAngle(bS);if(bJ){var b2=Math.sqrt(bt*bt+bs*bs),bL=Math.atan2(bs,bt)-bJ*Math.PI/180;bt=b2*Math.cos(bL);bs=b2*Math.sin(bL)}if(ab.indexOf("n")==-1&&ab.indexOf("s")==-1){bs=0}if(ab.indexOf("e")==-1&&ab.indexOf("w")==-1){bt=0}var cb=null,b6=0,b5=0,bz=bq?(bq+bs)/bq:1,bA=bo?(bo+bt)/bo:1;if(ab.indexOf("n")!=-1){bz=bq?(bq-bs)/bq:1;b5=bq}if(ab.indexOf("w")!=-1){bA=bo?(bo-bt)/bo:1;b6=bo}var cg=G.createSVGTransform(),bW=G.createSVGTransform(),bD=G.createSVGTransform();cg.setTranslate(-(bv+b6),-(bw+b5));if(bU.shiftKey){if(bA==1){bA=bz}else{bz=bA}}bW.setScale(bA,bz);bD.setTranslate(bv+b6,bw+b5);if(bC){var bR=bJ?1:0;bY.replaceItem(cg,2+bR);bY.replaceItem(bW,1+bR);bY.replaceItem(bD,0+bR)}else{var by=bY.numberOfItems;bY.replaceItem(bD,by-3);bY.replaceItem(bW,by-2);bY.replaceItem(cg,by-1)}var bE=t[0];bE.x=bv;bE.y=bw;if(b6){bE.x+=bt}if(b5){bE.y+=bs}F.requestSelector(bS).resize();break;case"zoom":x*=ad;y*=ad;ax(j,{x:Math.min(bm*ad,x),y:Math.min(bl*ad,y),width:Math.abs(x-bm*ad),height:Math.abs(y-bl*ad)},100);break;case"text":ax(bM,{x:x,y:y},1000);break;case"line":var bN=null;if(!window.opera){G.suspendRedraw(1000)}var bH=x;var ce=y;if(bU.shiftKey){var bV=Utils.snapToAngle(bm,bl,bH,ce);bH=bV.x;ce=bV.y}bM.setAttributeNS(null,"x2",bH);bM.setAttributeNS(null,"y2",ce);if(!window.opera){G.unsuspendRedraw(bN)}break;case"foreignObject":case"square":case"rect":case"image":var cd=(a1=="square")||bU.shiftKey,bZ=Math.abs(x-bm),ca=Math.abs(y-bl),bG,bF;if(cd){bZ=ca=Math.max(bZ,ca);bG=bm<x?bm:bm-bZ;bF=bl<y?bl:bl-ca}else{bG=Math.min(bm,x);bF=Math.min(bl,y)}ax(bM,{width:bZ,height:ca,x:bG,y:bF},1000);break;case"circle":var cc=$(bM).attr(["cx","cy"]);var bP=cc.cx,bO=cc.cy,br=Math.sqrt((x-bP)*(x-bP)+(y-bO)*(y-bO));bM.setAttributeNS(null,"r",br);break;case"ellipse":var cc=$(bM).attr(["cx","cy"]);var bP=cc.cx,bO=cc.cy;bN=null;if(!window.opera){G.suspendRedraw(1000)}bM.setAttributeNS(null,"rx",Math.abs(x-bP));var bQ=Math.abs(bU.shiftKey?(x-bP):(y-bO));bM.setAttributeNS(null,"ry",bQ);if(!window.opera){G.unsuspendRedraw(bN)}break;case"fhellipse":case"fhrect":bg.minx=Math.min(x,bg.minx);bg.maxx=Math.max(x,bg.maxx);bg.miny=Math.min(y,bg.miny);bg.maxy=Math.max(y,bg.maxy);case"fhpath":bm=x;bl=y;bf+=+x+","+y+" ";bM.setAttributeNS(null,"points",bf);break;case"path":case"pathedit":x*=ad;y*=ad;if(bU.shiftKey){var bI=path.dragging?path.dragging[0]:bm;var cf=path.dragging?path.dragging[1]:bl;var bV=Utils.snapToAngle(bI,cf,x,y);x=bV.x;y=bV.y}if(j&&j.getAttribute("display")!="none"){ax(j,{x:Math.min(bm,x),y:Math.min(bl,y),width:Math.abs(x-bm),height:Math.abs(y-bl)},100)}w.mouseMove(x,y);break;case"textedit":x*=ad;y*=ad;L.mouseMove(b1,b0);break;case"rotate":var bx=bb.getBBox(bS),bP=bx.x+bx.width/2,bO=bx.y+bx.height/2,b4=z(bS),bp=P(bP,bO,b4);bP=bp.x;bO=bp.y;var bJ=((Math.atan2(bO-y,bP-x)*(180/Math.PI))-90)%360;if(bU.shiftKey){var bX=45;bJ=Math.round(bJ/bX)*bX}bb.setRotationAngle(bJ<-180?(360+bJ):bJ,true);ah("changed",aO);break;default:break}aG("mouseMove",{event:bU,mouse_x:b1,mouse_y:b0,selected:bS})};var bj=function(by){if(by.button===1){return}var bt=K;K=null;if(!aE){return}var bB=P(by.pageX,by.pageY,o),bp=bB.x*ad,bo=bB.y*ad,bv=bp/ad,bu=bo/ad,br=b(A()),bH=false;aE=false;switch(a1){case"resize":case"multiselect":if(j!=null){j.setAttribute("display","none");aF=[]}a1="select";case"select":if(aO[0]!=null){if(aO[1]==null){var bA=aO[0];if(bA.tagName!="g"&&bA.tagName!="image"&&bA.tagName!="foreignObject"){q.fill=bA.getAttribute("fill");q.fill_opacity=bA.getAttribute("fill-opacity");q.stroke=bA.getAttribute("stroke");q.stroke_opacity=bA.getAttribute("stroke-opacity");q.stroke_width=bA.getAttribute("stroke-width");q.stroke_dasharray=bA.getAttribute("stroke-dasharray");q.stroke_linejoin=bA.getAttribute("stroke-linejoin");q.stroke_linecap=bA.getAttribute("stroke-linecap")}if(bA.tagName=="text"){a5.font_size=bA.getAttribute("font-size");a5.font_family=bA.getAttribute("font-family")}F.requestSelector(bA).showGrips(true)}aY();if(bv!=bm||bu!=bl){var bF=aO.length;for(var bE=0;bE<bF;++bE){if(aO[bE]==null){break}if(aO[bE].tagName!="g"){F.requestSelector(aO[bE]).resize()}}}else{var bx=by.target;if(aO[0].nodeName=="path"&&aO[1]==null){w.select(bx)}else{if(aO[0].nodeName=="text"&&aO[1]==null){L.select(bx,bv,bu)}else{if(by.shiftKey){if(bt!=bx){bb.removeFromSelection([bx])}}}}}}return;break;case"zoom":if(j!=null){j.setAttribute("display","none")}var bz=by.shiftKey?0.5:2;ah("zoomed",{x:Math.min(bm,bv),y:Math.min(bl,bu),width:Math.abs(bv-bm),height:Math.abs(bu-bl),factor:bz});return;case"fhpath":var bD=br.getAttribute("points");var bs=bD.indexOf(",");if(bs>=0){bH=bD.indexOf(",",bs+1)>=0}else{bH=bD.indexOf(" ",bD.indexOf(" ")+1)>=0}if(bH){br=w.smoothPolylineIntoPath(br)}break;case"line":var bC=$(br).attr(["x1","x2","y1","y2"]);bH=(bC.x1!=bC.x2||bC.y1!=bC.y2);break;case"foreignObject":case"square":case"rect":case"image":var bC=$(br).attr(["width","height"]);bH=(bC.width!=0||bC.height!=0)||a1==="image";break;case"circle":bH=(br.getAttribute("r")!=0);break;case"ellipse":var bC=$(br).attr(["rx","ry"]);bH=(bC.rx!=null||bC.ry!=null);break;case"fhellipse":if((bg.maxx-bg.minx)>0&&(bg.maxy-bg.miny)>0){br=c({element:"ellipse",curStyles:true,attr:{cx:(bg.minx+bg.maxx)/2,cy:(bg.miny+bg.maxy)/2,rx:(bg.maxx-bg.minx)/2,ry:(bg.maxy-bg.miny)/2,id:A()}});ah("changed",[br]);bH=true}break;case"fhrect":if((bg.maxx-bg.minx)>0&&(bg.maxy-bg.miny)>0){br=c({element:"rect",curStyles:true,attr:{x:bg.minx,y:bg.miny,width:(bg.maxx-bg.minx),height:(bg.maxy-bg.miny),id:A()}});ah("changed",[br]);bH=true}break;case"text":bH=true;bb.addToSelection([br]);L.start(br);break;case"path":br=null;aE=true;var bJ=w.mouseUp(by,br,bp,bo);br=bJ.element;bH=bJ.keep;break;case"pathedit":bH=true;br=null;w.mouseUp(by);break;case"textedit":bH=false;br=null;L.mouseUp(by,bp,bo);break;case"rotate":bH=true;br=null;a1="select";var bw=bb.finishUndoableChange();if(!bw.isEmpty()){aQ(bw)}aY();break;default:break}var bG=aG("mouseUp",{event:by,mouse_x:bp,mouse_y:bo},true);$.each(bG,function(bK,bL){if(bL){bH=bL.keep||bH;br=bL.element;aE=bL.started||aE}});if(!bH&&br!=null){br.parentNode.removeChild(br);br=null;var bx=by.target;while(bx.parentNode.parentNode.tagName=="g"){bx=bx.parentNode}if((a1!="path"||current_path_pts.length==0)&&bx.parentNode.id!="selectorParentGroup"&&bx.id!="svgcanvas"&&bx.id!="svgroot"){bb.addToSelection([bx],true);bb.setMode("select")}}else{if(br!=null){bb.addedNew=true;var bI=0.2,bq;if(N.beginElement&&br.getAttribute("opacity")!=aL.opacity){bq=$(N).clone().attr({to:aL.opacity,dur:bI}).appendTo(br);bq[0].beginElement()}else{bI=0}setTimeout(function(){if(bq){bq.remove()}br.setAttribute("opacity",aL.opacity);br.setAttribute("style","pointer-events:inherit");ar(br);if(a1=="path"){w.toEditMode(br)}else{if(a1=="text"||a1=="image"||a1=="foreignObject"){bb.addToSelection([br],true)}}aQ(new a(br));ah("changed",[br])},bI*1000)}}ak=null};var bh=function(bo){bo.preventDefault();return false};$(aJ).mousedown(bi).mousemove(bn).click(bh);$(window).mouseup(bj);$(aJ).bind("mousewheel DOMMouseScroll",function(bp){if(!bp.shiftKey){return}bp.preventDefault();o=aj.getScreenCTM().inverse();var bo=P(bp.pageX,bp.pageY,o);var bq={x:bo.x,y:bo.y,width:0,height:0};if(bp.wheelDelta){if(bp.wheelDelta>=120){bq.factor=2}else{if(bp.wheelDelta<=-120){bq.factor=0.5}}}else{if(bp.detail){if(bp.detail>0){bq.factor=0.5}else{if(bp.detail<0){bq.factor=2}}}}if(!bq.factor){return}ah("zoomed",bq)})}());var L=bb.textActions=function(){var bo,bs;var bu;var bk;var br;var bl;var bz=[];var bA,bt;var bv;var bh,bf;var bi;function bB(bC){var bD=(bu.value==="");if(!arguments.length){if(bD){bC=0}else{if(bu.selectionEnd!==bu.selectionStart){return}bC=bu.selectionEnd}}var bE;bE=bz[bC];if(!bD){bu.setSelectionRange(bC,bC)}bk=b("text_cursor");if(!bk){bk=document.createElementNS(aI,"line");ax(bk,{id:"text_cursor",stroke:"#333","stroke-width":1});bk=b("selectorParentGroup").appendChild(bk)}if(!bl){bl=setInterval(function(){var bH=(bk.getAttribute("display")==="none");bk.setAttribute("display",bH?"inline":"none")},600)}var bG=bp(bE.x,bA.y);var bF=bp(bE.x,(bA.y+bA.height));ax(bk,{x1:bG.x,y1:bG.y,x2:bF.x,y2:bF.y,visibility:"visible",display:"inline"});if(br){br.setAttribute("d","")}}function bm(bC,bF,bE){if(bC===bF){bB(bF);return}if(!bE){bu.setSelectionRange(bC,bF)}br=b("text_selectblock");if(!br){br=document.createElementNS(aI,"path");ax(br,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});b("selectorParentGroup").appendChild(br)}var bI=bz[bC];var bJ=bz[bF];bk.setAttribute("visibility","hidden");var bL=bp(bI.x,bA.y),bH=bp(bI.x+(bJ.x-bI.x),bA.y),bD=bp(bI.x,bA.y+bA.height),bK=bp(bI.x+(bJ.x-bI.x),bA.y+bA.height);var bG="M"+bL.x+","+bL.y+" L"+bH.x+","+bH.y+" "+bK.x+","+bK.y+" "+bD.x+","+bD.y+"z";ax(br,{d:bG,display:"inline"})}function bn(bD,bC){var bF=G.createSVGPoint();bF.x=bD;bF.y=bC;if(bz.length==1){return 0}var bH=bo.getCharNumAtPosition(bF);if(bH<0){bH=bz.length-2;if(bD<=bz[0].x){bH=0}}else{if(bH>=bz.length-2){bH=bz.length-2}}var bG=bz[bH];var bE=bG.x+(bG.width/2);if(bD>bE){bH++}return bH}function bx(bD,bC){bB(bn(bD,bC))}function bw(bC,bI,bE){var bG=bu.selectionStart;var bF=bn(bC,bI);var bH=Math.min(bG,bF);var bD=Math.max(bG,bF);bm(bH,bD,!bE)}function bq(bF,bD){var bC={x:bF,y:bD};bC.x/=ad;bC.y/=ad;if(bv){var bE=P(bC.x,bC.y,bv.inverse());bC.x=bE.x;bC.y=bE.y}return bC}function bp(bF,bD){var bC={x:bF,y:bD};if(bv){var bE=P(bC.x,bC.y,bv);bC.x=bE.x;bC.y=bE.y}bC.x*=ad;bC.y*=ad;return bC}function bg(){if(bk){bk.setAttribute("visibility","hidden")}}function by(bC){bm(0,bo.textContent.length);$(this).unbind(bC)}function bj(bJ){if(!bi){return}var bK=P(bJ.pageX,bJ.pageY,o),bH=bK.x*ad,bF=bK.y*ad;var bL=bq(bH,bF);var bE=bn(bL.x,bL.y);var bG=bo.textContent;var bD=bG.substr(0,bE).replace(/[a-z0-9]+$/i,"").length;var bC=bG.substr(bE).match(/^[a-z0-9]+/i);var bI=(bC?bC[0].length:0)+bE;bm(bD,bI);$(bJ.target).click(by);setTimeout(function(){$(bJ.target).unbind("click",by)},300)}return{select:function(bD,bC,bE){if(bs==bD){bo=bD;L.toEditMode(bC,bE)}else{bs=bD}},start:function(bC){bo=bC;L.toEditMode()},mouseDown:function(bD,bF,bE,bC){var bG=bq(bE,bC);bu.focus();bx(bG.x,bG.y);bh=bE;bf=bC},mouseMove:function(bD,bC){var bE=bq(bD,bC);bw(bE.x,bE.y)},mouseUp:function(bE,bD,bC){var bF=bq(bD,bC);bw(bF.x,bF.y,true);if(bh===bD&&bf===bC&&bE.target!==bo){L.toSelectMode(true)}},setCursor:bB,toEditMode:function(bC,bE){bi=false;a1="textedit";F.requestSelector(bo).showGrips(false);L.init();$(bo).css("cursor","text");if(!arguments.length){bB()}else{var bD=bq(bC,bE);bx(bD.x,bD.y)}setTimeout(function(){bi=true},300)},toSelectMode:function(bC){a1="select";clearInterval(bl);bl=null;if(br){$(br).attr("display","none")}if(bk){$(bk).attr("visibility","hidden")}$(bo).css("cursor","move");if(bC){bb.clearSelection();$(bo).css("cursor","move");ah("selected",[bo]);bb.addToSelection([bo],true)}if(bo&&!bo.textContent.length){bb.deleteSelectedElements()}$(bu).blur();bo=false},setInputElem:function(bC){bu=bC;$(bu).blur(bg)},clear:function(){bs=null;if(a1=="textedit"){L.toSelectMode()}},init:function(bG){if(!bo){return}if(!bo.parentNode){bo=aO[0];F.requestSelector(bo).showGrips(false)}var bH=bo.textContent;var bD=bH.length;var bC=bo.getAttribute("transform");bA=bb.getBBox(bo);bv=bC?z(bo):null;bz=Array(bD);bu.focus();$(bo).unbind("dblclick",bj).dblclick(bj);if(!bD){var bE={x:bA.x+(bA.width/2),width:0}}for(var bF=0;bF<bD;bF++){var bI=bo.getStartPositionOfChar(bF);var bE=bo.getEndPositionOfChar(bF);bz[bF]={x:bI.x,y:bA.y,width:bE.x-bI.x,height:bA.height}}bz.push({x:bE.x,width:0});bm(bu.selectionStart,bu.selectionEnd,true)}}}();var w=function(){var bf=false;var by={};var bu;var bs;var bk={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"]};function bD(){return bs}function bl(bF){bF.setAttribute("d",w.convertPath(bF))}function bp(bK,bM,bH){var bL=bK.pathSegList;if(aZ.pathInsertItemBefore){bL.insertItemBefore(bM,bH);return}var bG=bL.numberOfItems;var bF=[];for(var bJ=0;bJ<bG;bJ++){var bI=bL.getItem(bJ);bF.push(bI)}bL.clear();for(var bJ=0;bJ<bG;bJ++){if(bJ==bH){bL.appendItem(bM)}bL.appendItem(bF[bJ])}}function bo(bK,bH){var bG=bk[bK],bF=bG.length;var bI=Array(bF);for(var bJ=0;bJ<bF;bJ++){bI[bJ]=bH[bG[bJ]]}return bI}function bn(){var bG=b("pathpointgrip_container");if(!bG){var bF=b("selectorParentGroup");bG=bF.appendChild(document.createElementNS(aI,"g"));bG.id="pathpointgrip_container"}return bG}var bq=function(bH,bF,bK){var bJ=bn();var bI=b("pathpointgrip_"+bH);if(!bI){bI=document.createElementNS(aI,"circle");ax(bI,{id:"pathpointgrip_"+bH,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":az.pathNodeTooltip});bI=bJ.appendChild(bI);var bG=$("#pathpointgrip_"+bH);bG.dblclick(function(){if(bs){bs.setSegType()}})}if(bF&&bK){ax(bI,{cx:bF,cy:bK,display:"inline"})}return bI};var bz=function(bF,bJ){var bG=bF.index;var bH=bq(bG);if(bJ){var bI=bj(bF);ax(bH,{cx:bI.x,cy:bI.y,display:"inline"})}return bH};var bv=function(bH,bG){var bK=bH.index;var bL=b("segline_"+bK);if(!bL){var bJ=bn();bL=document.createElementNS(aI,"path");ax(bL,{id:"segline_"+bK,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});bJ.appendChild(bL)}if(bG){var bF=bH.prev;if(!bF){bL.setAttribute("display","none");return bL}var bN=bj(bF);bi(2,0,[bN.x,bN.y],bL);var bM=bo(bH.type,bH.item,true);for(var bI=0;bI<bM.length;bI+=2){var bN=bj(bH,{x:bM[bI],y:bM[bI+1]});bM[bI]=bN.x;bM[bI+1]=bN.y}bi(bH.type,1,bM,bL)}return bL};var bg=function(bJ){var bP=bJ.item;var bN=bJ.index;if(!("x1" in bP)||!("x2" in bP)){return null}var bL={};var bM=bn();var bG=bs.segs[bN-1].item;var bI=[bG,bP];for(var bK=1;bK<3;bK++){var bF=bN+"c"+bK;var bR=bL["c"+bK+"_line"]=b("ctrlLine_"+bF);if(!bR){bR=document.createElementNS(aI,"line");ax(bR,{id:"ctrlLine_"+bF,stroke:"#555","stroke-width":1,style:"pointer-events:none"});bM.appendChild(bR)}var bQ=bj(bJ,{x:bP["x"+bK],y:bP["y"+bK]});var bH=bj(bJ,{x:bI[bK-1].x,y:bI[bK-1].y});ax(bR,{x1:bQ.x,y1:bQ.y,x2:bH.x,y2:bH.y,display:"inline"});bL["c"+bK+"_line"]=bR;var bO=bL["c"+bK]=b("ctrlpointgrip_"+bF);if(!bO){bO=document.createElementNS(aI,"circle");ax(bO,{id:"ctrlpointgrip_"+bF,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":az.pathCtrlPtTooltip});bM.appendChild(bO)}ax(bO,{cx:bQ.x,cy:bQ.y,display:"inline"});bL["c"+bK]=bO}return bL};function bj(bF,bJ){var bG={x:bJ?bJ.x:bF.item.x,y:bJ?bJ.y:bF.item.y},bI=bF.path;if(bI.matrix){var bH=P(bG.x,bG.y,bI.matrix);bG=bH}bG.x*=ad;bG.y*=ad;return bG}function bx(bH,bG){var bF={x:bH.x,y:bH.y};if(bG.matrix){var bH=P(bF.x,bF.y,bG.imatrix);bF.x=bH.x;bF.y=bH.y}bF.x/=ad;bF.y/=ad;return bF}function bt(bG,bI){var bH=this;bH.index=bG;bH.selected=false;bH.type=bI.pathSegType;var bF;bH.addGrip=function(){bF=bH.ptgrip=bz(bH,true);bH.ctrlpts=bg(bH,true);bH.segsel=bv(bH,true)};bH.item=bI;bH.show=function(bJ){if(bF){bF.setAttribute("display",bJ?"inline":"none");bH.segsel.setAttribute("display",bJ?"inline":"none");bH.showCtrlPts(bJ)}};bH.select=function(bJ){if(bF){bF.setAttribute("stroke",bJ?"#0FF":"#00F");bH.segsel.setAttribute("display",bJ?"inline":"none");if(bH.ctrlpts){bH.selectCtrls(bJ)}bH.selected=bJ}};bH.selectCtrls=function(bJ){$("#ctrlpointgrip_"+bH.index+"c1, #ctrlpointgrip_"+bH.index+"c2").attr("fill",bJ?"#0FF":"#EEE")};bH.update=function(bJ){bI=bH.item;if(bF){var bK=bj(bH);ax(bF,{cx:bK.x,cy:bK.y});bv(bH,true);if(bH.ctrlpts){if(bJ){bH.item=bs.elem.pathSegList.getItem(bH.index);bH.type=bH.item.pathSegType}bg(bH)}}};bH.move=function(bL,bK){var bN=bH.item;var bQ=bH;if(bQ.ctrlpts){var bJ=[bN.x+=bL,bN.y+=bK,bN.x1,bN.y1,bN.x2+=bL,bN.y2+=bK]}else{var bJ=[bN.x+=bL,bN.y+=bK]}bi(bQ.type,bQ.index,bJ);if(bH.next&&bH.next.ctrlpts){var bM=bH.next.item;var bO=[bM.x,bM.y,bM.x1+=bL,bM.y1+=bK,bM.x2,bM.y2];bi(bH.next.type,bH.next.index,bO)}if(bH.mate){var bN=bH.mate.item;var bP=[bN.x+=bL,bN.y+=bK];bi(bH.mate.type,bH.mate.index,bP)}bH.update(true);if(bH.next){bH.next.update(true)}};bH.setLinked=function(bK){var bJ,bO,bM;if(bK==2){bO=1;bJ=bH.next;if(!bJ){return}bM=bH.item}else{bO=2;bJ=bH.prev;if(!bJ){return}bM=bJ.item}var bL=bJ.item;bL["x"+bO]=bM.x+(bM.x-bH.item["x"+bK]);bL["y"+bO]=bM.y+(bM.y-bH.item["y"+bK]);var bN=[bL.x,bL.y,bL.x1,bL.y1,bL.x2,bL.y2];bi(bJ.type,bJ.index,bN);bJ.update(true)};bH.moveCtrl=function(bL,bK,bJ){var bM=bH.item;bM["x"+bL]+=bK;bM["y"+bL]+=bJ;var bN=[bM.x,bM.y,bM.x1,bM.y1,bM.x2,bM.y2];bi(bH.type,bH.index,bN);bH.update(true)};bH.setType=function(bK,bJ){bi(bK,bG,bJ);bH.type=bK;bH.item=bs.elem.pathSegList.getItem(bG);bH.showCtrlPts(bK===6);bH.ctrlpts=bg(bH);bH.update(true)};bH.showCtrlPts=function(bK){if(bH.ctrlpts){for(var bJ in bH.ctrlpts){bH.ctrlpts[bJ].setAttribute("display",bK?"inline":"none")}}}}function bB(bF){if(!bF||bF.tagName!=="path"){return false}var bG=bs=this;this.elem=bF;this.segs=[];this.selected_pts=[];this.init=function(){$(bn()).find("*").attr("display","none");var bK=bF.pathSegList;var bQ=bK.numberOfItems;bG.segs=[];bG.selected_pts=[];bG.first_seg=null;for(var bN=0;bN<bQ;bN++){var bR=bK.getItem(bN);var bO=new bt(bN,bR);bO.path=bG;bG.segs.push(bO)}var bI=bG.segs;var bP=null;for(var bN=0;bN<bQ;bN++){var bM=bI[bN];var bL=(bN+1)>=bQ?null:bI[bN+1];var bH=(bN-1)<0?null:bI[bN-1];if(bM.type===2){if(bH&&bH.type!==1){var bJ=bI[bP];bJ.next=bI[bP+1];bJ.next.prev=bJ;bJ.addGrip()}bP=bN}else{if(bL&&bL.type===1){bM.next=bI[bP+1];bM.next.prev=bM;bM.mate=bI[bP];bM.addGrip();if(bG.first_seg==null){bG.first_seg=bM}}else{if(!bL){if(bM.type!==1){var bJ=bI[bP];bJ.next=bI[bP+1];bJ.next.prev=bJ;bJ.addGrip();bM.addGrip();if(!bG.first_seg){bG.first_seg=bI[bP]}}}else{if(bM.type!==1){bM.addGrip();if(bL&&bL.type!==2){bM.next=bL;bM.next.prev=bM}}}}}}return bG};this.init();this.update=function(){if(bb.getRotationAngle(bG.elem)){bG.matrix=z(bs.elem);bG.imatrix=bG.matrix.inverse()}bG.eachSeg(function(bH){this.item=bF.pathSegList.getItem(bH);this.update()});return bG};this.eachSeg=function(bK){var bH=bG.segs.length;for(var bJ=0;bJ<bH;bJ++){var bI=bK.call(bG.segs[bJ],bJ);if(bI===false){break}}};this.addSeg=function(bS){var bR=bG.segs[bS];if(!bR.prev){return}var bO=bR.prev;var bN;switch(bR.item.pathSegType){case 4:var bU=(bR.item.x+bO.item.x)/2;var bT=(bR.item.y+bO.item.y)/2;bN=bF.createSVGPathSegLinetoAbs(bU,bT);break;case 6:var bW=(bO.item.x+bR.item.x1)/2;var bM=(bR.item.x1+bR.item.x2)/2;var bQ=(bR.item.x2+bR.item.x)/2;var bL=(bW+bM)/2;var bJ=(bM+bQ)/2;var bU=(bL+bJ)/2;var bV=(bO.item.y+bR.item.y1)/2;var bK=(bR.item.y1+bR.item.y2)/2;var bP=(bR.item.y2+bR.item.y)/2;var bI=(bV+bK)/2;var bH=(bK+bP)/2;var bT=(bI+bH)/2;bN=bF.createSVGPathSegCurvetoCubicAbs(bU,bT,bW,bV,bL,bI);var bX=[bR.item.x,bR.item.y,bJ,bH,bQ,bP];bi(bR.type,bS,bX);break}bp(bF,bN,bS)};this.deleteSeg=function(bI){var bH=bG.segs[bI];var bL=bF.pathSegList;bH.show(false);var bJ=bH.next;if(bH.mate){var bM=[bJ.item.x,bJ.item.y];bi(2,bJ.index,bM);bi(4,bH.index,bM);bL.removeItem(bH.mate.index)}else{if(!bH.prev){var bK=bH.item;var bM=[bJ.item.x,bJ.item.y];bi(2,bH.next.index,bM);bL.removeItem(bI)}else{bL.removeItem(bI)}}};this.endChanges=function(bI){if(aA){bl(bG.elem)}var bH=new au(bF,{d:bG.last_d},bI);aQ(bH);ah("changed",[bF])};this.subpathIsClosed=function(bI){var bH=false;bs.eachSeg(function(bJ){if(bJ<=bI){return true}if(this.type===2){return false}else{if(this.type===1){bH=true;return false}}});return bH};this.addPtsToSelection=function(bJ){if(!$.isArray(bJ)){bJ=[bJ]}for(var bK=0;bK<bJ.length;bK++){var bI=bJ[bK];var bH=bG.segs[bI];if(bH.ptgrip){if($.inArray(bI,bG.selected_pts)==-1&&bI>=0){bG.selected_pts.push(bI)}}}bG.selected_pts.sort();var bK=bG.selected_pts.length,bM=new Array(bK);while(bK--){var bL=bG.selected_pts[bK];var bH=bG.segs[bL];bH.select(true);bM[bK]=bH.ptgrip}w.canDeleteNodes=true;w.closed_subpath=bG.subpathIsClosed(bG.selected_pts[0]);ah("selected",bM)};this.removePtFromSelection=function(bH){var bI=$.inArray(bH,bG.selected_pts);if(bI==-1){return}bG.segs[bH].select(false);bG.selected_pts.splice(bI,1)};this.clearSelection=function(){bG.eachSeg(function(bH){this.select(false)});bG.selected_pts=[]};this.selectPt=function(bI,bH){bG.clearSelection();if(bI==null){bG.eachSeg(function(bJ){if(this.prev){bI=bJ}})}bG.addPtsToSelection(bI);if(bH){bG.dragctrl=bH;if(br){bG.segs[bI].setLinked(bH)}}};this.storeD=function(){this.last_d=bF.getAttribute("d")};this.show=function(bH){bG.eachSeg(function(){this.show(bH)});if(bH){bG.selectPt(bG.first_seg.index)}return bG};this.movePts=function(bK,bJ){var bI=bG.selected_pts.length;while(bI--){var bH=bG.segs[bG.selected_pts[bI]];bH.move(bK,bJ)}};this.moveCtrl=function(bJ,bI){var bH=bG.segs[bG.selected_pts[0]];bH.moveCtrl(bG.dragctrl,bJ,bI);if(br){bH.setLinked(bG.dragctrl)}};this.setSegType=function(bO){bG.storeD();var bX=bG.selected_pts.length;var bT;while(bX--){var bV=bG.selected_pts[bX];var bI=bG.segs[bV];var bU=bI.prev;if(!bU){continue}if(!bO){bT="Toggle Path Segment Type";var bS=bI.type;bO=(bS==6)?4:6}bO=bO-0;var bP=bI.item.x;var bN=bI.item.y;var bK=bU.item.x;var bJ=bU.item.y;var bW;switch(bO){case 6:if(bI.olditem){var bH=bI.olditem;bW=[bP,bN,bH.x1,bH.y1,bH.x2,bH.y2]}else{var bR=bP-bK;var bQ=bN-bJ;var bM=(bK+(bR/3));var bL=(bJ+(bQ/3));var bZ=(bP-(bR/3));var bY=(bN-(bQ/3));bW=[bP,bN,bM,bL,bZ,bY]}break;case 4:bW=[bP,bN];bI.olditem=bI.item;break}bI.setType(bO,bW)}bs.endChanges(bT);return}}function bh(bF){var bG=by[bF.id];if(!bG){bG=by[bF.id]=new bB(bF)}return bG}var bw=[],bu=null,bC=[],br=false,bA=false;var bm=function(bI){var bO=bI.points;var bM=bO.numberOfItems;if(bM>=4){var bG=bO.getItem(0),bK=null;var bN=[];bN.push(["M",bG.x,",",bG.y," C"].join(""));for(var bJ=1;bJ<=(bM-4);bJ+=3){var bF=bO.getItem(bJ);var bR=bO.getItem(bJ+1);var bH=bO.getItem(bJ+2);if(bK){var bP=Y(bK,bF,bG);if(bP&&bP.length==2){var bL=bN[bN.length-1].split(",");bL[2]=bP[0].x;bL[3]=bP[0].y;bN[bN.length-1]=bL.join(",");bF=bP[1]}}bN.push([bF.x,bF.y,bR.x,bR.y,bH.x,bH.y].join(","));bG=bH;bK=bR}bN.push("L");for(;bJ<bM;++bJ){var bQ=bO.getItem(bJ);bN.push([bQ.x,bQ.y].join(","))}bN=bN.join(" ");bI=c({element:"path",curStyles:true,attr:{id:A(),d:bN,fill:"none"}});ah("changed",[bI])}return bI};var bi=function(bO,bN,bP,bF){var bQ=bF||bD().elem;var bG="createSVGPathSeg"+bw[bO];var bJ=bQ[bG].apply(bQ,bP);if(aZ.pathReplaceItem){bQ.pathSegList.replaceItem(bJ,bN)}else{var bH=bQ.pathSegList;var bM=bH.numberOfItems;var bL=[];for(var bK=0;bK<bM;bK++){var bI=bH.getItem(bK);bL.push(bI)}bH.clear();for(var bK=0;bK<bM;bK++){if(bK==bN){bH.appendItem(bJ)}else{bH.appendItem(bL[bK])}}}};var bE=function(){var bQ=bs.elem;var bV=bb.getRotationAngle(bQ,true);if(!bV){return}t[0]=bs.oldbbox;var bL=bb.getBBox(bQ),bP=t[0],bG=bP.x+bP.width/2,bF=bP.y+bP.height/2,bZ=bL.x+bL.width/2,bX=bL.y+bL.height/2,bN=bZ-bG,bM=bX-bF,bO=Math.sqrt(bN*bN+bM*bM),bJ=Math.atan2(bM,bN)+bV;bZ=bO*Math.cos(bJ)+bG;bX=bO*Math.sin(bJ)+bF;var bT=function(b0,b1){bN=b0-bG;bM=b1-bF;bO=Math.sqrt(bN*bN+bM*bM);bJ=Math.atan2(bM,bN)+bV;bN=bO*Math.cos(bJ)+bG;bM=bO*Math.sin(bJ)+bF;bN-=bZ;bM-=bX;bO=Math.sqrt(bN*bN+bM*bM);bJ=Math.atan2(bM,bN)-bV;return{x:(bO*Math.cos(bJ)+bZ)/1,y:(bO*Math.sin(bJ)+bX)/1}};var bW=bQ.pathSegList,bS=bW.numberOfItems;while(bS){bS-=1;var bU=bW.getItem(bS),bI=bU.pathSegType;if(bI==1){continue}var bY=bT(bU.x,bU.y),bR=[bY.x,bY.y];if(bU.x1!=null&&bU.x2!=null){c_vals1=bT(bU.x1,bU.y1);c_vals2=bT(bU.x2,bU.y2);bR.splice(bR.length,0,c_vals1.x,c_vals1.y,c_vals2.x,c_vals2.y)}bi(bI,bS,bR)}bL=bb.getBBox(bQ);t[0].x=bL.x;t[0].y=bL.y;t[0].width=bL.width;t[0].height=bL.height;var bH=G.createSVGTransform(),bK=bb.getTransformList(bQ);bH.setRotate((bV*180/Math.PI),bZ,bX);bK.replaceItem(bH,0)};return{init:function(){bw=[0,"ClosePath"];var bF=["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"];$.each(bF,function(bG,bH){bw.push(bH+"Abs");bw.push(bH+"Rel")})},getPath:function(){return bs},mouseDown:function(bN,bH,bM,bL){if(a1=="path"){return}if(!bs){return}bs.storeD();var bF=bN.target.id;if(bF.substr(0,14)=="pathpointgrip_"){var bG=bs.cur_pt=parseInt(bF.substr(14));bs.dragging=[bM,bL];var bK=bs.segs[bG];if(!bN.shiftKey){if(bs.selected_pts.length<=1||!bK.selected){bs.clearSelection()}bs.addPtsToSelection(bG)}else{if(bK.selected){bs.removePtFromSelection(bG)}else{bs.addPtsToSelection(bG)}}}else{if(bF.indexOf("ctrlpointgrip_")==0){bs.dragging=[bM,bL];var bJ=bF.split("_")[1].split("c");var bG=bJ[0]-0;var bI=bJ[1]-0;bs.selectPt(bG,bI)}}if(!bs.dragging){if(j==null){j=F.getRubberBandBox()}ax(j,{x:bM*ad,y:bL*ad,width:0,height:0,display:"inline"},100)}},mouseMove:function(bI,bF){bA=true;if(a1=="path"){var bH=b("path_stretch_line");if(bH){bH.setAttribute("x2",bI);bH.setAttribute("y2",bF)}return}if(bs.dragging){var bL=bx({x:bs.dragging[0],y:bs.dragging[1]},bs);var bG=bx({x:bI,y:bF},bs);var bK=bG.x-bL.x;var bJ=bG.y-bL.y;bs.dragging=[bI,bF];if(bs.dragctrl){bs.moveCtrl(bK,bJ)}else{bs.movePts(bK,bJ)}}else{bs.selected_pts=[];bs.eachSeg(function(bO){var bM=this;if(!bM.next&&!bM.prev){return}var bP=bM.item;var bN=j.getBBox();var bS=bj(bM);var bR={x:bS.x,y:bS.y,width:0,height:0};var bQ=Utils.rectsIntersect(bN,bR);this.select(bQ);if(bQ){bs.selected_pts.push(bM.index)}})}},mouseUp:function(bQ,bH,bG,bF){if(a1=="path"){var bN=bG/ad,bM=bF/ad,bI=b("path_stretch_line");if(!bI){bI=document.createElementNS(aI,"line");ax(bI,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5"});bI=b("selectorParentGroup").appendChild(bI)}bI.setAttribute("display","inline");var b0=null;if(bC.length==0){bC.push(bN);bC.push(bM);d_attr="M"+bN+","+bM+" ";c({element:"path",curStyles:true,attr:{d:d_attr,id:a6(),opacity:aL.opacity/2,}});ax(bI,{x1:bG,y1:bF,x2:bG,y2:bF});var bK=bf?bs.segs.length:0;bq(bK,bG,bF)}else{var bW=bC.length;var bJ=6/ad;var bV=false;while(bW){bW-=2;var bR=bC[bW],bP=bC[bW+1];if(bN>=(bR-bJ)&&bN<=(bR+bJ)&&bM>=(bP-bJ)&&bM<=(bP+bJ)){bV=true;break}}var bT=A();if(bT in by){delete by[bT]}var bZ=b(bT);var bY=bC.length;if(bV){if(bW==0&&bY>=6){var b2=bC[0];var b1=bC[1];d_attr+=["L",b2,",",b1,"z"].join("");bZ.setAttribute("d",d_attr)}else{if(bY<3){b0=false;return b0}}$(bI).remove();bH=bZ;bC=[];aE=false;if(bf){if(bs.matrix){B(bZ,{},bs.matrix.inverse())}var b3=bZ.getAttribute("d");var bX=$(bs.elem).attr("d");$(bs.elem).attr("d",bX+b3);$(bZ).remove();if(bs.matrix){bE()}bs.init();w.toEditMode(bs.elem);bs.selectPt();return false}}else{if(!$.contains(aJ,aa(bQ))){console.log("Clicked outside canvas");return false}var bU=bC[bY-2],bS=bC[bY-1];if(bQ.shiftKey){var bO=Utils.snapToAngle(bU,bS,bN,bM);bN=bO.x;bM=bO.y}bC.push(bN);bC.push(bM);d_attr+="L"+Q(bN)+","+Q(bM)+" ";bZ.setAttribute("d",d_attr);ax(bI,{x1:bN,y1:bM,x2:bN,y2:bM});var bK=(bC.length/2-1);if(bf){bK+=bs.segs.length}bq(bK,bN,bM)}b0=true}return{keep:b0,element:bH}}if(bs.dragging){var bL=bs.cur_pt;bs.dragging=false;bs.dragctrl=false;bs.update();if(bA){bs.endChanges("Move path point(s)")}if(!bQ.shiftKey&&!bA){bs.selectPt(bL)}}else{if(j&&j.getAttribute("display")!="none"){j.setAttribute("display","none");if(j.getAttribute("width")<=2&&j.getAttribute("height")<=2){w.toSelectMode(bQ.target)}}else{w.toSelectMode(bQ.target)}}bA=false},clearData:function(){by={}},toEditMode:function(bF){bs=bh(bF);a1="pathedit";bb.clearSelection();bs.show(true).update();bs.oldbbox=bb.getBBox(bs.elem);bf=false},toSelectMode:function(bF){var bG=(bF==bs.elem);a1="select";bs.show(false);bu=false;bb.clearSelection();if(bs.matrix){bE()}if(bG){ah("selected",[bF]);bb.addToSelection([bF],true)}},addSubPath:function(bF){if(bF){a1="path";bf=true}else{w.clear(true);w.toEditMode(bs.elem)}},select:function(bF){if(bu==bF){w.toEditMode(bF);a1="pathedit"}else{bu=bF}},reorient:function(){var bH=aO[0];if(!bH){return}var bI=bb.getRotationAngle(bH);if(bI==0){return}var bF=new ay("Reorient path");var bG={d:bH.getAttribute("d"),transform:bH.getAttribute("transform")};bF.addSubCommand(new au(bH,bG));bb.clearSelection();this.resetOrientation(bH);aQ(bF);bh(bH).show(false).matrix=null;this.clear();bb.addToSelection([bH],true);ah("changed",aO)},clear:function(bF){bu=null;if(a1=="path"&&bC.length>0){var bG=b(A());$(b("path_stretch_line")).remove();$(bG).remove();$(b("pathpointgrip_container")).find("*").attr("display","none");bC=[];aE=false}else{if(a1=="pathedit"){this.toSelectMode()}}if(bs){bs.init().show(false)}},resetOrientation:function(bP){if(bP==null||bP.nodeName!="path"){return false}var bL=bb.getTransformList(bP);var bG=r(bL).matrix;bL.clear();bP.removeAttribute("transform");var bH=bP.pathSegList;try{var bM=bH.numberOfItems}catch(bI){var bF=w.convertPath(bP);bP.setAttribute("d",bF);bH=bP.pathSegList;var bM=bH.numberOfItems}for(var bK=0;bK<bM;++bK){var bJ=bH.getItem(bK);var bN=bJ.pathSegType;if(bN==1){continue}var bO=[];$.each(["",1,2],function(bR,bU){var bQ=bJ["x"+bU],bT=bJ["y"+bU];if(bQ&&bT){var bS=P(bQ,bT,bG);bO.splice(bO.length,0,bS.x,bS.y)}});bi(bN,bK,bO,bP)}},zoomChange:function(){if(a1=="pathedit"){bs.update()}},getNodePoint:function(){var bG=bs.selected_pts.length?bs.selected_pts[0]:1;var bF=bs.segs[bG];return{x:bF.item.x,y:bF.item.y,type:bF.type}},linkControlPoints:function(bF){br=bF},clonePathNode:function(){bs.storeD();var bG=bs.selected_pts;var bF=bs.segs;var bH=bG.length;var bJ=[];while(bH--){var bI=bG[bH];bs.addSeg(bI);bJ.push(bI+bH);bJ.push(bI+bH+1)}bs.init().addPtsToSelection(bJ);bs.endChanges("Clone path node(s)")},opencloseSubPath:function(){var bF=bs.selected_pts;if(bF.length!==1){return}var bI=bs.elem;var bP=bI.pathSegList;var bO=bP.numberOfItems;var bN=bF[0];var bQ=null;var bH=null;bs.eachSeg(function(bV){if(this.type===2&&bV<=bN){bH=this.item}if(bV<=bN){return true}if(this.type===2){bQ=bV;return false}else{if(this.type===1){bQ=false;return false}}});if(bQ==null){bQ=bs.segs.length-1}if(bQ!==false){var bJ=bI.createSVGPathSegLinetoAbs(bH.x,bH.y);var bS=bI.createSVGPathSegClosePath();if(bQ==bs.segs.length-1){bP.appendItem(bJ);bP.appendItem(bS)}else{bp(bI,bS,bQ);bp(bI,bJ,bQ)}bs.init().selectPt(bQ+1);return}var bK=bs.segs[bN];if(bK.mate){bP.removeItem(bN);bP.removeItem(bN);bs.init().selectPt(bN-1);return}var bG,bU;for(var bL=0;bL<bP.numberOfItems;bL++){var bR=bP.getItem(bL);if(bR.pathSegType===2){bG=bL}else{if(bL===bN){bP.removeItem(bG)}else{if(bR.pathSegType===1&&bN<bL){bU=bL-1;bP.removeItem(bL);break}}}}var bM=(bN-bG)-1;while(bM--){bp(bI,bP.getItem(bG),bU)}var bT=bP.getItem(bG);bi(2,bG,[bT.x,bT.y]);var bL=bN;bs.init().selectPt(0)},deletePathNode:function(){if(!w.canDeleteNodes){return}bs.storeD();var bF=bs.selected_pts;var bG=bF.length;while(bG--){var bJ=bF[bG];bs.deleteSeg(bJ)}var bH=function(){var bM=bs.elem.pathSegList;var bL=bM.numberOfItems;var bK=function(bS,bR){while(bR--){bM.removeItem(bS)}};if(bL<=1){return true}while(bL--){var bP=bM.getItem(bL);if(bP.pathSegType===1){var bO=bM.getItem(bL-1);var bN=bM.getItem(bL-2);if(bO.pathSegType===2){bK(bL-1,2);bH();break}else{if(bN.pathSegType===2){bK(bL-2,3);bH();break}}}else{if(bP.pathSegType===2){if(bL>0){var bQ=bM.getItem(bL-1).pathSegType;if(bQ===2){bK(bL-1,1);bH();break}else{if(bQ===1&&bM.numberOfItems-1===bL){bK(bL,1);bH();break}}}}}}return false};bH();if(bs.elem.pathSegList.numberOfItems<=1){w.toSelectMode(bs.elem);bb.deleteSelectedElements();return}bs.init();bs.clearSelection();if(window.opera){var bI=$(bs.elem);bI.attr("d",bI.attr("d"))}bs.endChanges("Delete path node(s)")},smoothPolylineIntoPath:bm,setSegType:function(bF){bs.setSegType(bF)},moveNode:function(bF,bJ){var bH=bs.selected_pts;if(!bH.length){return}bs.storeD();var bG=bs.segs[bH[0]];var bI={x:0,y:0};bI[bF]=bJ-bG.item[bF];bG.move(bI.x,bI.y);bs.endChanges("Move path point")},fixEnd:function(bL){var bH=bL.pathSegList;var bG=bH.numberOfItems;var bF;for(var bI=0;bI<bG;++bI){var bK=bH.getItem(bI);if(bK.pathSegType===2){bF=bK}if(bK.pathSegType===1){var bJ=bH.getItem(bI-1);if(bJ.x!=bF.x||bJ.y!=bF.y){var bM=bL.createSVGPathSegLinetoAbs(bF.x,bF.y);bp(bL,bM,bI);w.fixEnd(bL);break}}}if(aA){bl(bL)}},convertPath:function(bO,bN){var bF=bO.pathSegList;var bS=bF.numberOfItems;var bQ=0,bP=0;var bW="";var bK=null;for(var bR=0;bR<bS;++bR){var bU=bF.getItem(bR);var bM=bU.x||0,bL=bU.y||0,bV=bU.x1||0,bH=bU.y1||0,bT=bU.x2||0,bG=bU.y2||0;var bI=bU.pathSegType;var bX=E[bI]["to"+(bN?"Lower":"Upper")+"Case"]();var bJ=function(bY,bZ,b0){var b1="";var bZ=bZ?" "+bZ.join(" "):"";var b0=b0?a3(b0):"";$.each(bY,function(b2,b3){bY[b2]=a3(b3)});bW+=bX+bY.join(" ")+bZ+b0};switch(bI){case 1:bW+="z";break;case 12:bM-=bQ;case 13:if(bN){bQ+=bM}else{bM+=bQ;bQ=bM}bJ([[bM]]);break;case 14:bL-=bP;case 15:if(bN){bP+=bL}else{bL+=bP;bP=bL}bJ([[bL]]);break;case 2:case 4:case 18:bM-=bQ;bL-=bP;case 5:case 3:if(bK&&bF.getItem(bR-1).pathSegType===1&&!bN){bQ=bK[0];bP=bK[1]}case 19:if(bN){bQ+=bM;bP+=bL}else{bM+=bQ;bL+=bP;bQ=bM;bP=bL}if(bI===3){bK=[bQ,bP]}bJ([[bM,bL]]);break;case 6:bM-=bQ;bV-=bQ;bT-=bQ;bL-=bP;bH-=bP;bG-=bP;case 7:if(bN){bQ+=bM;bP+=bL}else{bM+=bQ;bV+=bQ;bT+=bQ;bL+=bP;bH+=bP;bG+=bP;bQ=bM;bP=bL}bJ([[bV,bH],[bT,bG],[bM,bL]]);break;case 8:bM-=bQ;bV-=bQ;bL-=bP;bH-=bP;case 9:if(bN){bQ+=bM;bP+=bL}else{bM+=bQ;bV+=bQ;bL+=bP;bH+=bP;bQ=bM;bP=bL}bJ([[bV,bH],[bM,bL]]);break;case 10:bM-=bQ;bL-=bP;case 11:if(bN){bQ+=bM;bP+=bL}else{bM+=bQ;bL+=bP;bQ=bM;bP=bL}bJ([[bU.r1,bU.r2]],[bU.angle,(bU.largeArcFlag?1:0),(bU.sweepFlag?1:0)],[bM,bL]);break;case 16:bM-=bQ;bT-=bQ;bL-=bP;bG-=bP;case 17:if(bN){bQ+=bM;bP+=bL}else{bM+=bQ;bT+=bQ;bL+=bP;bG+=bP;bQ=bM;bP=bL}bJ([[bT,bG],[bM,bL]]);break}}return bW}}}();w.init();this.pathActions=w;var a3=function(bg){var bf=ai.round_digits;if(!isNaN(bg)){return Number(Number(bg).toFixed(bf))}else{if($.isArray(bg)){return a3(bg[0])+","+a3(bg[1])}}};this.convertToPath=function(bz,bA,bx){if(bz==null){var bF=aO;$.each(aO,function(bG,bH){if(bH){bb.convertToPath(bH)}});return}if(!bA){var br=new ay("Convert element to Path")}var bv=bA?{}:{fill:aL.fill,"fill-opacity":aL.fill_opacity,stroke:aL.stroke,"stroke-width":aL.stroke_width,"stroke-dasharray":aL.stroke_dasharray,"stroke-linejoin":aL.stroke_linejoin,"stroke-linecap":aL.stroke_linecap,"stroke-opacity":aL.stroke_opacity,opacity:aL.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(bz.getAttribute(this)){bv[this]=bz.getAttribute(this)}});var bt=c({element:"path",attr:bv});var bD=bz.getAttribute("transform");if(bD){bt.setAttribute("transform",bD)}var bu=bz.id;var bo=bz.parentNode;if(bz.nextSibling){bo.insertBefore(bt,bz)}else{bo.appendChild(bt)}var bB="";var bk=function(bG){$.each(bG,function(bJ,bI){var bH=bI[0],bL=bI[1];bB+=bH;for(var bK=0;bK<bL.length;bK+=2){bB+=(bL[bK]+","+bL[bK+1])+" "}})};var bl=1.81;switch(bz.tagName){case"ellipse":case"circle":var bE=$(bz).attr(["rx","ry","cx","cy"]);var bg=bE.cx,bf=bE.cy,bi=bE.rx,bh=bE.ry;if(bz.tagName=="circle"){bi=bh=$(bz).attr("r")}bk([["M",[(bg-bi),(bf)]],["C",[(bg-bi),(bf-bh/bl),(bg-bi/bl),(bf-bh),(bg),(bf-bh)]],["C",[(bg+bi/bl),(bf-bh),(bg+bi),(bf-bh/bl),(bg+bi),(bf)]],["C",[(bg+bi),(bf+bh/bl),(bg+bi/bl),(bf+bh),(bg),(bf+bh)]],["C",[(bg-bi/bl),(bf+bh),(bg-bi),(bf+bh/bl),(bg-bi),(bf)]],["Z",[]]]);break;case"path":bB=bz.getAttribute("d");break;case"line":var bE=$(bz).attr(["x1","y1","x2","y2"]);bB="M"+bE.x1+","+bE.y1+"L"+bE.x2+","+bE.y2;break;case"polyline":case"polygon":bB="M"+bz.getAttribute("points");break;case"rect":var bs=$(bz).attr(["rx","ry"]);var bi=bs.rx,bh=bs.ry;var bC=bz.getBBox();var bp=bC.x,bn=bC.y,bq=bC.width,bw=bC.height;var bl=4-bl;if(!bi&&!bh){bk([["M",[bp,bn]],["L",[bp+bq,bn]],["L",[bp+bq,bn+bw]],["L",[bp,bn+bw]],["L",[bp,bn]],["Z",[]]])}else{bk([["M",[bp,bn+bh]],["C",[bp,bn+bh/bl,bp+bi/bl,bn,bp+bi,bn]],["L",[bp+bq-bi,bn]],["C",[bp+bq-bi/bl,bn,bp+bq,bn+bh/bl,bp+bq,bn+bh]],["L",[bp+bq,bn+bw-bh]],["C",[bp+bq,bn+bw-bh/bl,bp+bq-bi/bl,bn+bw,bp+bq-bi,bn+bw]],["L",[bp+bi,bn+bw]],["C",[bp+bi/bl,bn+bw,bp,bn+bw-bh/bl,bp,bn+bw-bh]],["L",[bp,bn+bh]],["Z",[]]])}break;default:bt.parentNode.removeChild(bt);break}if(bB){bt.setAttribute("d",bB)}if(!bA){if(bD){var bm=bb.getTransformList(bt);if(aN(bm)){w.resetOrientation(bt)}}br.addSubCommand(new R(bz,bo));br.addSubCommand(new a(bt));bb.clearSelection();bz.parentNode.removeChild(bz);bt.setAttribute("id",bu);bt.removeAttribute("visibility");bb.addToSelection([bt],true);aQ(br)}else{w.resetOrientation(bt);var bj=false;try{bj=bt.getBBox()}catch(by){}bt.parentNode.removeChild(bt);return bj}};this.open=function(){};this.save=function(bf){this.clearSelection();if(bf){$.extend(ai,bf)}ai.apply=true;var bg=i();ah("saved",bg)};this.rasterExport=function(){this.clearSelection();var bg=[];var bf={feGaussianBlur:az.exportNoBlur,image:az.exportNoImage,foreignObject:az.exportNoforeignObject,"[stroke-dasharray]":az.exportNoDashArray};var bh=$(aj);if(!("font" in $("<canvas>")[0].getContext("2d"))){bf.text=az.exportNoText}$.each(bf,function(bj,bk){if(bh.find(bj).length){bg.push(bk)}});var bi=i();ah("exported",{svg:bi,issues:bg})};var at=function(bh,bf){if(bh&&bh.nodeType==1){bf(bh);var bg=bh.childNodes.length;while(bg--){at(bh.childNodes.item(bg),bf)}}};var a7=function(bh,bf){if(bh&&bh.nodeType==1){var bg=bh.childNodes.length;while(bg--){at(bh.childNodes.item(bg),bf)}bf(bh)}};this.getSvgString=function(){ai.apply=false;return i()};this.randomizeIds=function(){if(arguments.length>0&&arguments[0]==false){p=false;if(e.Arrows){ah("unsetarrownonce")}}else{p=true;if(!aj.getAttributeNS(an,"nonce")){aj.setAttributeNS(an,"se:nonce",m);if(e.Arrows){ah("setarrownonce",m)}}}};this.setSvgString=function(bj){try{var bm=Utils.text2xml(bj);M(bm.documentElement);var bf=new ay("Change Source");var bi=G.removeChild(aj);bf.addSubCommand(new R(bi,G));aj=G.appendChild(aK.importNode(bm.documentElement,true));n=aj.getAttributeNS(an,"nonce");if(n){p=true;m=n;if(e.Arrows){ah("setarrownonce",n)}}else{if(p){aj.setAttributeNS(be,"xmlns:se",an);aj.setAttributeNS(an,"se:nonce",m);if(e.Arrows){ah("setarrownonce",m)}}}$(aj).find("image").each(function(){var bq=this;aU(bq);var br=this.getAttributeNS(aC,"href");if(br.indexOf("data:")===0){var bo=br.match(/svgedit_url=(.*?);/);if(bo){var bp=decodeURIComponent(bo[1]);$(new Image()).load(function(){bq.setAttributeNS(aC,"xlink:href",bp)}).attr("src",bp)}}bb.embedImage(br)});$(aj).find("linearGradient, radialGradient").each(function(){var br=this;if($(br).attr("gradientUnits")==="userSpaceOnUse"){var bo=$(aj).find("[fill=url(#"+br.id+")],[stroke=url(#"+br.id+")]");if(!bo.length){return}var bq=bo[0].getBBox();if(br.tagName==="linearGradient"){var bp=$(br).attr(["x1","y1","x2","y2"]);$(br).attr({x1:(bp.x1-bq.x)/bq.width,y1:(bp.y1-bq.y)/bq.height,x2:(bp.x2-bq.x)/bq.width,y2:(bp.y1-bq.y)/bq.height});br.removeAttribute("gradientUnits")}else{}}});if(!aZ.goodDecimals){bb.fixOperaXML(aj,bm.documentElement)}a7(aj,function(bp){try{l(bp)}catch(bo){console.log(bo)}});var bh=$(aj);var bn={id:"svgcontent",overflow:J.show_outside_canvas?"visible":"hidden"};if(bh.attr("viewBox")){var bk=bh.attr("viewBox").split(" ");bn.width=bk[2];bn.height=bk[3]}else{$.each(["width","height"],function(bo,bp){var bq=bh.attr(bp)||100;if((bq+"").substr(-1)==="%"){bn[bp]=parseInt(bq)}else{bn[bp]=a2(bp,bq)}})}bh.attr(bn);this.contentW=bn.width;this.contentH=bn.height;bf.addSubCommand(new a(aj));var bl=bh.attr(["width","height"]);bf.addSubCommand(new au(G,bl));ad=1;Z();U={};bb.clearSelection();w.clearData();G.appendChild(F.selectorParentGroup);aQ(bf);ah("changed",[aj])}catch(bg){console.log(bg);return false}return true};this.importSvgString=function(bo){try{var by=Utils.text2xml(bo);M(by.documentElement);var bm=new ay("Change Source");var bg=aK.importNode(by.documentElement,true);if(W){var bi=bg.getAttribute("width"),bn=bg.getAttribute("height"),bj=bg.getAttribute("viewBox"),bh=bj?bj.split(" "):[0,0,bi,bn];for(var bv=0;bv<4;++bv){bh[bv]=Number(bh[bv])}var bq=Number(aj.getAttribute("width")),bB=Number(aj.getAttribute("height"));if(bn>bi){var bf="scale("+(bB/3)/bh[3]+")"}else{var bf="scale("+(bB/3)/bh[2]+")"}bf="translate(0) "+bf+" translate(0)";var bx=aK.createElementNS(aI,"g");while(bg.hasChildNodes()){bx.appendChild(bg.firstChild)}if(bf){bx.setAttribute("transform",bf)}var bt={};at(bx,function(bE){if(bE.nodeType==1){if(bE.id){if(!(bE.id in bt)){bt[bE.id]={elem:null,attrs:[],hrefs:[]}}bt[bE.id]["elem"]=bE}$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(bH,bF){var bJ=bE.getAttributeNode(bF);if(bJ){var bG=am(bJ.value),bI=bG?bG.substr(1):null;if(bI){if(!(bI in bt)){bt[bI]={elem:null,attrs:[],hrefs:[]}}bt[bI]["attrs"].push(bJ)}}});var bC=bE.getAttributeNS(aC,"href");if(bC&&$.inArray(bE.nodeName,["filter","linearGradient","pattern","radialGradient","textPath","use"])!=-1){var bD=bC.substr(1);if(!(bD in bt)){bt[bD]={elem:null,attrs:[],hrefs:[]}}bt[bD]["hrefs"].push(bE)}}});for(var bl in bt){var bA=bt[bl]["elem"];if(bA){var bk=a6();a4++;bA.id=bk;var bp=bt[bl]["attrs"];var bv=bp.length;while(bv--){var bs=bp[bv];bs.ownerElement.setAttribute(bs.name,"url(#"+bk+")")}var bw=bt[bl]["hrefs"];var bu=bw.length;while(bu--){var br=bw[bu];br.setAttributeNS(aC,"xlink:href","#"+bk)}}}bx.id=a6();a4++;W.appendChild(bx)}if(!aZ.goodDecimals){bb.fixOperaXML(aj,bg)}a7(aj,function(bD){try{l(bD)}catch(bC){console.log(bC)}});bm.addSubCommand(new a(aj));U={};bb.clearSelection();aQ(bm);ah("changed",[aj])}catch(bz){console.log(bz);return false}return true};var Z=function(){aP=[];var bn=aj.childNodes.length;var bh=[],bo=[];for(var bk=0;bk<bn;++bk){var bg=aj.childNodes.item(bk);if(bg&&bg.nodeType==1){if(bg.tagName=="g"){var bf=$("title",bg).text();if(bf){bo.push(bf);aP.push([bf,bg]);W=bg;at(bg,function(bp){bp.setAttribute("style","pointer-events:inherit")});W.setAttribute("style","pointer-events:none")}else{bh.push(bg)}}else{if(bb.getBBox(bg)&&bg.nodeName!="defs"){var bm=bb.getBBox(bg);bh.push(bg)}}}}if(bh.length>0){var bk=1;while($.inArray(("Layer "+bk),bo)!=-1){bk++}var bi="Layer "+bk;W=aK.createElementNS(aI,"g");var bl=aK.createElementNS(aI,"title");bl.textContent=bi;W.appendChild(bl);for(var bj=0;bj<bh.length;++bj){W.appendChild(bh[bj])}W=aj.appendChild(W);aP.push([bi,W])}at(W,function(bp){bp.setAttribute("style","pointer-events:inherit")});W.setAttribute("style","pointer-events:all")};this.createLayer=function(bh){var bg=new ay("Create Layer");var bf=aK.createElementNS(aI,"g");var bi=aK.createElementNS(aI,"title");bi.textContent=bh;bf.appendChild(bi);bf=aj.appendChild(bf);bg.addSubCommand(new a(bf));aQ(bg);bb.clearSelection();Z();bb.setCurrentLayer(bh);ah("changed",[bf])};this.deleteCurrentLayer=function(){if(W&&aP.length>1){var bf=new ay("Delete Layer");var bg=W.parentNode;bf.addSubCommand(new R(W,bg));bg.removeChild(W);aQ(bf);bb.clearSelection();Z();bb.setCurrentLayer(aP[aP.length-1][0]);ah("changed",[aj]);return true}return false};this.getNumLayers=function(){return aP.length};this.getLayer=function(bf){if(bf>=0&&bf<bb.getNumLayers()){return aP[bf][0]}return""};this.getCurrentLayer=function(){for(var bf=0;bf<aP.length;++bf){if(aP[bf][1]==W){return aP[bf][0]}}return""};this.setCurrentLayer=function(bf){bf=d(bf);for(var bg=0;bg<aP.length;++bg){if(bf==aP[bg][0]){if(W!=aP[bg][1]){bb.clearSelection();W.setAttribute("style","pointer-events:none");W=aP[bg][1];W.setAttribute("style","pointer-events:all")}return true}}return false};this.renameCurrentLayer=function(bj){if(W){var bg=W;if(!bb.setCurrentLayer(bj)){var bh=new ay("Rename Layer");for(var bi=0;bi<aP.length;++bi){if(aP[bi][1]==bg){break}}var bk=aP[bi][0];aP[bi][0]=d(bj);var bf=bg.childNodes.length;for(var bi=0;bi<bf;++bi){var bl=bg.childNodes.item(bi);if(bl&&bl.tagName=="title"){while(bl.firstChild){bl.removeChild(bl.firstChild)}bl.textContent=bj;bh.addSubCommand(new au(bl,{"#text":bk}));aQ(bh);ah("changed",[bg]);return true}}}W=bg}return false};this.setCurrentLayerPosition=function(bh){if(W&&bh>=0&&bh<aP.length){for(var bf=0;bf<aP.length;++bf){if(aP[bf][1]==W){break}}if(bf==aP.length){return false}if(bf!=bh){var bi=null;var bg=W.nextSibling;if(bh>bf){if(bh<aP.length-1){bi=aP[bh+1][1]}}else{bi=aP[bh][1]}aj.insertBefore(W,bi);aQ(new S(W,bg,aj));Z();bb.setCurrentLayer(aP[bh][0]);return true}}return false};this.getLayerVisibility=function(bh){var bg=null;for(var bf=0;bf<aP.length;++bf){if(aP[bf][0]==bh){bg=aP[bf][1];break}}if(!bg){return false}return(bg.getAttribute("display")!="none")};this.setLayerVisibility=function(bi,bf){var bh=null;for(var bg=0;bg<aP.length;++bg){if(aP[bg][0]==bi){bh=aP[bg][1];break}}if(!bh){return false}var bj=bh.getAttribute("display");if(!bj){bj="inline"}bh.setAttribute("display",bf?"inline":"none");aQ(new au(bh,{display:bj},"Layer Visibility"));if(bh==W){bb.clearSelection();w.clear()}return true};this.moveSelectedToLayer=function(bl){var bj=null;for(var bi=0;bi<aP.length;++bi){if(aP[bi][0]==bl){bj=aP[bi][1];break}}if(!bj){return false}var bh=new ay("Move Elements to Layer");var bg=aO;var bi=bg.length;while(bi--){var bk=bg[bi];if(!bk){continue}var bm=bk.nextSibling;var bf=bk.parentNode;bj.appendChild(bk);bh.addSubCommand(new S(bk,bm,bf))}aQ(bh);return true};this.getLayerOpacity=function(bi){for(var bg=0;bg<aP.length;++bg){if(aP[bg][0]==bi){var bh=aP[bg][1];var bf=bh.getAttribute("opacity");if(!bf){bf="1.0"}return parseFloat(bf)}}return null};this.setLayerOpacity=function(bi,bf){if(bf<0||bf>1){return}for(var bg=0;bg<aP.length;++bg){if(aP[bg][0]==bi){var bh=aP[bg][1];bh.setAttribute("opacity",bf);break}}};this.selectAllInCurrentLayer=function(){if(W){bb.clearSelection();bb.addToSelection($(W).children());a1="select";ah("selected",aO)}};this.clear=function(){w.clear();var bg=aj.childNodes;var bf=aj.childNodes.length;var bh=0;this.clearSelection();for(var bi=0;bi<bf;bi++){if(bg[bh].nodeType==1){aj.removeChild(bg[bh])}else{bh++}}aP=[];bb.createLayer("Layer 1");aH();F.initGroup();j=F.getRubberBandBox();ah("cleared")};this.linkControlPoints=function(bf){w.linkControlPoints(bf)};this.getContentElem=function(){return aj};this.getRootElem=function(){return G};this.getSelectedElems=function(){return aO};this.getResolution=function(){return{w:aj.getAttribute("width")/ad,h:aj.getAttribute("height")/ad,zoom:ad}};this.getDocumentTitle=function(){var bg=aj.childNodes;for(var bf=0;bf<bg.length;bf++){if(bg[bf].nodeName=="title"){return bg[bf].textContent}}return""};this.setDocumentTitle=function(bi){var bj=aj.childNodes,bk=false,bh="";var bf=new ay("Change Image Title");for(var bg=0;bg<bj.length;bg++){if(bj[bg].nodeName=="title"){bk=bj[bg];bh=bk.textContent;break}}if(!bk){bk=aK.createElementNS(aI,"title");aj.insertBefore(bk,aj.firstChild)}if(bi.length){bk.textContent=bi}else{bk.parentNode.removeChild(bk)}bf.addSubCommand(new au(bk,{"#text":bh}));aQ(bf)};this.getEditorNS=function(bf){if(bf){aj.setAttribute("xmlns:se",an)}return an};this.setResolution=function(bm,bl){var bk=bb.getResolution();var bn=bk.w,bh=bk.h;var bg;if(bm=="fit"){var bo=bb.getStrokedBBox();if(bo){bg=new ay("Fit Canvas to Content");var bi=bb.getVisibleElements();bb.addToSelection(bi);var bq=[],bp=[];$.each(bi,function(br,bs){bq.push(bo.x*-1);bp.push(bo.y*-1)});var bf=bb.moveSelectedElements(bq,bp,true);bg.addSubCommand(bf);bb.clearSelection();bm=Math.round(bo.width);bl=Math.round(bo.height)}else{return false}}if(bm!=bn||bl!=bh){var bj=G.suspendRedraw(1000);if(!bg){bg=new ay("Change Image Dimensions")}bm=a2("width",bm);bl=a2("height",bl);aj.setAttribute("width",bm);aj.setAttribute("height",bl);this.contentW=bm;this.contentH=bl;bg.addSubCommand(new au(aj,{width:bn,height:bh}));aj.setAttribute("viewBox",[0,0,bm/ad,bl/ad].join(" "));bg.addSubCommand(new au(aj,{viewBox:["0 0",bn,bh].join(" ")}));aQ(bg);G.unsuspendRedraw(bj);ah("changed",[aj])}return true};this.getOffset=function(){return $(aj).attr(["x","y"])};this.setBBoxZoom=function(bg,bn,bh){var bm=0.85;var bl;var bj=function(br){if(!br){return false}var bq=Math.round((bn/br.width)*100*bm)/100;var bo=Math.round((bh/br.height)*100*bm)/100;var bp=Math.min(bq,bo);bb.setZoom(bp);return{zoom:bp,bbox:br}};if(typeof bg=="object"){bl=bg;if(bl.width==0||bl.height==0){var bf=bl.zoom?bl.zoom:ad*bl.factor;bb.setZoom(bf);return{zoom:ad,bbox:bl}}return bj(bl)}switch(bg){case"selection":if(!aO[0]){return}var bi=$.map(aO,function(bo){if(bo){return bo}});bl=bb.getStrokedBBox(bi);break;case"canvas":var bk=bb.getResolution();bm=0.95;bl={width:bk.w,height:bk.h,x:0,y:0};break;case"content":bl=bb.getStrokedBBox();break;case"layer":bl=bb.getStrokedBBox(bb.getVisibleElements(W));break;default:return}return bj(bl)};this.setZoom=function(bf){var bg=bb.getResolution();aj.setAttribute("viewBox","0 0 "+bg.w/bf+" "+bg.h/bf);ad=bf;$.each(aO,function(bh,bi){if(!bi){return}F.requestSelector(bi).resize()});w.zoomChange();aG("zoomChanged",bf)};this.getMode=function(){return a1};this.setMode=function(bf){w.clear(true);L.clear();q=(aO[0]&&aO[0].nodeName=="text")?a5:aL;a1=bf};this.getStrokeColor=function(){return q.stroke};this.setStrokeColor=function(bj,bg){aL.stroke=bj;q.stroke_paint={type:"solidColor"};var bf=[];var bh=aO.length;while(bh--){var bi=aO[bh];if(bi){if(bi.tagName=="g"){at(bi,function(bk){if(bk.nodeName!="g"){bf.push(bk)}})}else{bf.push(bi)}}}if(bf.length>0){if(!bg){this.changeSelectedAttribute("stroke",bj,bf);ah("changed",bf)}else{this.changeSelectedAttributeNoUndo("stroke",bj,bf)}}};this.getFillColor=function(){return q.fill};this.setFillColor=function(bj,bg){q.fill=bj;q.fill_paint={type:"solidColor"};var bf=[];var bh=aO.length;while(bh--){var bi=aO[bh];if(bi){if(bi.tagName=="g"){at(bi,function(bk){if(bk.nodeName!="g"){bf.push(bk)}})}else{if(bi.tagName!="polyline"&&bi.tagName!="line"){bf.push(bi)}}}}if(bf.length>0){if(!bg){this.changeSelectedAttribute("fill",bj,bf);ah("changed",bf)}else{this.changeSelectedAttributeNoUndo("fill",bj,bf)}}};var aB=function(){var bf=aj.getElementsByTagNameNS(aI,"defs");if(bf.length>0){bf=bf[0]}else{bf=aj.insertBefore(aK.createElementNS(aI,"defs"),aj.firstChild.nextSibling)}return bf};var C=function(){$.each(["stroke","fill"],function(bh,bi){if(!q[bi+"_paint"]||q[bi+"_paint"].type=="solidColor"){return}var bl=bb[bi+"Grad"];var bk=s(bl);var bf=aB();if(!bk){var bj=bl;bl=bf.appendChild(aK.importNode(bl,true));bb.fixOperaXML(bl,bj);bl.id=a6()}else{bl=bk}var bg=bi=="fill"?"Fill":"Stroke";bb["set"+bg+"Color"]("url(#"+bl.id+")")})};var s=function(bn){var bj=aB();var bp=$(bj).find("linearGradient, radialGradient");var bk=bp.length;var bg=["r","cx","cy","fx","fy"];while(bk--){var br=bp[bk];if(bn.tagName=="linearGradient"){if(bn.getAttribute("x1")!=br.getAttribute("x1")||bn.getAttribute("y1")!=br.getAttribute("y1")||bn.getAttribute("x2")!=br.getAttribute("x2")||bn.getAttribute("y2")!=br.getAttribute("y2")){continue}}else{var bh=$(bn).attr(bg);var bo=$(br).attr(bg);var bm=false;$.each(bg,function(bu,bt){if(bh[bt]!=bo[bt]){bm=true}});if(bm){continue}}var bq=bn.getElementsByTagNameNS(aI,"stop");var bs=br.getElementsByTagNameNS(aI,"stop");if(bq.length!=bs.length){continue}var bi=bq.length;while(bi--){var bl=bq[bi];var bf=bs[bi];if(bl.getAttribute("offset")!=bf.getAttribute("offset")||bl.getAttribute("stop-opacity")!=bf.getAttribute("stop-opacity")||bl.getAttribute("stop-color")!=bf.getAttribute("stop-color")){break}}if(bi==-1){return br}}return null};this.setStrokePaint=function(bg,bf){var bg=new $.jGraduate.Paint(bg);this.setStrokeOpacity(bg.alpha/100);q.stroke_paint=bg;if(bg.type=="solidColor"){this.setStrokeColor(bg.solidColor!="none"?"#"+bg.solidColor:"none")}else{if(bg.type=="linearGradient"){bb.strokeGrad=bg.linearGradient;if(bf){C()}}else{if(bg.type=="radialGradient"){bb.strokeGrad=bg.radialGradient;if(bf){C()}}else{}}}};this.setFillPaint=function(bg,bf){var bg=new $.jGraduate.Paint(bg);this.setFillOpacity(bg.alpha/100,true);q.fill_paint=bg;if(bg.type=="solidColor"){this.setFillColor(bg.solidColor!="none"?"#"+bg.solidColor:"none")}else{if(bg.type=="linearGradient"){bb.fillGrad=bg.linearGradient;if(bf){C()}}else{if(bg.type=="radialGradient"){bb.fillGrad=bg.radialGradient;if(bf){C()}}else{}}}};this.getStrokeWidth=function(){return q.stroke_width};this.setStrokeWidth=function(bi){if(bi==0&&$.inArray(a1,["line","path"])!=-1){bb.setStrokeWidth(1);return}q.stroke_width=bi;var bf=[];var bg=aO.length;while(bg--){var bh=aO[bg];if(bh){if(bh.tagName=="g"){at(bh,function(bj){if(bj.nodeName!="g"){bf.push(bj)}})}else{bf.push(bh)}}}if(bf.length>0){this.changeSelectedAttribute("stroke-width",bi,bf);ah("changed",aO)}};this.setStrokeAttr=function(bf,bj){aL[bf.replace("-","_")]=bj;var bg=[];var bh=aO.length;while(bh--){var bi=aO[bh];if(bi){if(bi.tagName=="g"){at(bi,function(bk){if(bk.nodeName!="g"){bg.push(bk)}})}else{bg.push(bi)}}}if(bg.length>0){this.changeSelectedAttribute(bf,bj,bg);ah("changed",aO)}};this.getOpacity=function(){return aL.opacity};this.setOpacity=function(bf){aL.opacity=bf;this.changeSelectedAttribute("opacity",bf)};this.getBlur=function(bf){var bi=0;if(bf){var bg=bf.getAttribute("filter");if(bg){var bh=b(bf.id+"_blur");if(bh){bi=bh.firstChild.getAttribute("stdDeviation")}}}return bi};(function(){var bh=null;var bi=null;var bf=false;bb.setBlurNoUndo=function(bj){if(!bi){bb.setBlur(bj);return}if(bj===0){bb.changeSelectedAttributeNoUndo("filter","");bf=true}else{if(bf){bb.changeSelectedAttributeNoUndo("filter","url(#"+aO[0].id+"_blur)")}bb.changeSelectedAttributeNoUndo("stdDeviation",bj,[bi.firstChild]);bb.setBlurOffsets(bi,bj)}};function bg(){var bj=bb.finishUndoableChange();bh.addSubCommand(bj);aQ(bh);bh=null;bi=null}bb.setBlurOffsets=function(bj,bk){if(bk>3){ax(bj,{x:"-50%",y:"-50%",width:"200%",height:"200%",},100)}else{bj.removeAttribute("x");bj.removeAttribute("y");bj.removeAttribute("width");bj.removeAttribute("height")}};bb.setBlur=function(bo,bk){if(bh){bg();return}var bn=aO[0];var bj=bn.id;bi=b(bj+"_blur");bo-=0;var bl=new ay();if(bi){if(bo===0){bi=null}}else{var bp=c({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:bo}});bi=c({element:"filter",attr:{id:bj+"_blur"}});bi.appendChild(bp);aB().appendChild(bi);bl.addSubCommand(new a(bi))}var bm={filter:bn.getAttribute("filter")};if(bo===0){bn.removeAttribute("filter");bl.addSubCommand(new au(bn,bm));return}else{this.changeSelectedAttribute("filter","url(#"+bj+"_blur)");bl.addSubCommand(new au(bn,bm));bb.setBlurOffsets(bi,bo)}bh=bl;bb.beginUndoableChange("stdDeviation",[bi?bi.firstChild:null]);if(bk){bb.setBlurNoUndo(bo);bg()}}}());this.getFillOpacity=function(){return aL.fill_opacity};this.setFillOpacity=function(bg,bf){aL.fill_opacity=bg;if(!bf){this.changeSelectedAttribute("fill-opacity",bg)}else{this.changeSelectedAttributeNoUndo("fill-opacity",bg)}};this.getStrokeOpacity=function(){return aL.stroke_opacity};this.setStrokeOpacity=function(bg,bf){aL.stroke_opacity=bg;if(!bf){this.changeSelectedAttribute("stroke-opacity",bg)}else{this.changeSelectedAttributeNoUndo("stroke-opacity",bg)}};this.getTransformList=function(bg){if(aA||!aZ.goodDecimals){var bh=bg.id;if(!bh){bh="temp"}var bf=U[bh];if(!bf||bh=="temp"){U[bh]=new H(bg);U[bh]._init();bf=U[bh]}return bf}else{if(bg.transform){return bg.transform.baseVal}else{if(bg.gradientTransform){return bg.gradientTransform.baseVal}}}return null};this.getBBox=function(bk){var bj=bk||aO[0];if(bk.nodeType!=1){return null}var bf=null;if(bk.nodeName=="text"&&bj.textContent==""){bj.textContent="a";bf=bj.getBBox();bj.textContent=""}else{if(bk.nodeName=="g"&&k){bf=bj.getBBox();var bi=document.createElementNS(aI,"g");while(bj.firstChild){bi.appendChild(bj.firstChild)}var bh=bj.attributes.length;while(bh--){bi.setAttributeNode(bj.attributes.item(bh).cloneNode(true))}bj.parentNode.appendChild(bi);bf=bi.getBBox();while(bi.firstChild){bj.appendChild(bi.firstChild)}bj.parentNode.removeChild(bi)}else{if(bk.nodeName=="path"&&aA){bf=ba(bj)}else{if(bk.nodeName=="use"&&!aA){bf=bj.getBBox();bf.x+=parseFloat(bj.getAttribute("x")||0);bf.y+=parseFloat(bj.getAttribute("y")||0)}else{if(bk.nodeName=="foreignObject"){bf=bj.getBBox();bf.x+=parseFloat(bj.getAttribute("x")||0);bf.y+=parseFloat(bj.getAttribute("y")||0)}else{try{bf=bj.getBBox()}catch(bl){var bg=$(bj).closest("foreignObject");if(bg.length){try{bf=bg[0].getBBox()}catch(bl){bf=null}}else{bf=null}}}}}}}return bf};this.getRotationAngle=function(bj,bg){var bi=bj||aO[0];var bl=bb.getTransformList(bi);if(!bl){return 0}var bk=bl.numberOfItems;for(var bh=0;bh<bk;++bh){var bf=bl.getItem(bh);if(bf.type==4){return bg?bf.angle*Math.PI/180:bf.angle}}return 0};this.setRotationAngle=function(bh,bp){bh=parseFloat(bh);var bi=aO[0];var bm=bi.getAttribute("transform");var bs=bb.getBBox(bi);var bl=bs.x+bs.width/2,bk=bs.y+bs.height/2;var bo=bb.getTransformList(bi);if(bo.numberOfItems>0){var br=bo.getItem(0);if(br.type==4){bo.removeItem(0)}}if(bh!=0){var bf=P(bl,bk,r(bo).matrix);var bq=G.createSVGTransform();bq.setRotate(bh,bf.x,bf.y);bo.insertItemBefore(bq,0)}else{if(bo.numberOfItems==0){bi.removeAttribute("transform")}}if(!bp){var bg=bi.getAttribute("transform");bi.setAttribute("transform",bm);this.changeSelectedAttribute("transform",bg,aO)}var bn=b("pathpointgrip_container");var bj=F.requestSelector(aO[0]);bj.resize();bj.updateGripCursors(bh)};this.each=function(bf){$(G).children().each(bf)};this.bind=function(bg,bh){var bf=D[bg];D[bg]=bh;return bf};this.setIdPrefix=function(bf){aT=bf};this.getBold=function(){var bf=aO[0];if(bf!=null&&bf.tagName=="text"&&aO[1]==null){return(bf.getAttribute("font-weight")=="bold")}return false};this.setBold=function(bf){var bg=aO[0];if(bg!=null&&bg.tagName=="text"&&aO[1]==null){this.changeSelectedAttribute("font-weight",bf?"bold":"normal")}};this.getItalic=function(){var bf=aO[0];if(bf!=null&&bf.tagName=="text"&&aO[1]==null){return(bf.getAttribute("font-style")=="italic")}return false};this.setItalic=function(bf){var bg=aO[0];if(bg!=null&&bg.tagName=="text"&&aO[1]==null){this.changeSelectedAttribute("font-style",bf?"italic":"normal")}};this.getFontFamily=function(){return a5.font_family};this.setFontFamily=function(bf){a5.font_family=bf;this.changeSelectedAttribute("font-family",bf)};this.getFontSize=function(){return a5.font_size};this.setFontSize=function(bf){a5.font_size=bf;L.toSelectMode();this.changeSelectedAttribute("font-size",bf)};this.getText=function(){var bf=aO[0];if(bf==null){return""}return bf.textContent};this.setTextContent=function(bf){this.changeSelectedAttribute("#text",bf);L.init(bf);L.setCursor()};this.setImageURL=function(bk){var bj=aO[0];if(!bj){return}var bh=$(bj).attr(["width","height"]);var bf=(!bh.width||!bh.height);var bi=bj.getAttributeNS(aC,"href");if(bi!==bk){bf=true}else{if(!bf){return}}var bg=new ay("Change Image URL");bj.setAttributeNS(aC,"xlink:href",bk);bg.addSubCommand(new au(bj,{"#href":bi}));if(bf){$(new Image()).load(function(){var bl=$(bj).attr(["width","height"]);$(bj).attr({width:this.width,height:this.height});F.requestSelector(bj).resize();bg.addSubCommand(new au(bj,bl));aQ(bg);ah("changed",bj)}).attr("src",bk)}else{aQ(bg)}};this.setRectRadius=function(bh){var bf=aO[0];if(bf!=null&&bf.tagName=="rect"){var bg=bf.getAttribute("rx");if(bg!=bh){bf.setAttribute("rx",bh);bf.setAttribute("ry",bh);aQ(new au(bf,{rx:bg,ry:bg},"Radius"));ah("changed",[bf])}}};this.setSegType=function(bf){w.setSegType(bf)};var g=function(bf){if(navigator.userAgent.indexOf("Gecko/")==-1){return bf}var bg=bf.cloneNode(true);bf.parentNode.insertBefore(bg,bf);bf.parentNode.removeChild(bf);F.releaseSelector(bf);aO[0]=bg;F.requestSelector(bg).showGrips(true);return bg};var aR=-1;var a0=[];this.beginUndoableChange=function(bi,bg){var bl=++aR;var bh=bg.length;var bf=new Array(bh),bk=new Array(bh);while(bh--){var bj=bg[bh];if(bj==null){continue}bk[bh]=bj;bf[bh]=bj.getAttribute(bi)}a0[bl]={attrName:bi,oldValues:bf,elements:bk}};this.changeSelectedAttributeNoUndo=function(bq,bo,by){var bv=G.suspendRedraw(1000);if(a1=="pathedit"){w.moveNode(bq,bo)}var by=by||aO;var bs=by.length;while(bs--){var bu=by[bs];if(bu==null){continue}if(a1==="textedit"&&bq!=="#text"){L.toSelectMode(bu)}if((bq=="x"||bq=="y")&&$.inArray(bu.tagName,["g","polyline","path"])!=-1){var bf=bb.getStrokedBBox([bu]);var bl=bq=="x"?bo-bf.x:0;var bk=bq=="y"?bo-bf.y:0;bb.moveSelectedElements(bl*ad,bk*ad,true);continue}if(bu.tagName=="g"&&$.inArray(bq,["transform","opacity","filter"])!==-1){}var bj=bq=="#text"?bu.textContent:bu.getAttribute(bq);if(bj==null){bj=""}if(bj!=String(bo)){if(bq=="#text"){var br=bb.getBBox(bu).width;bu.textContent=bo;bu=g(bu)}else{if(bq=="#href"){bu.setAttributeNS(aC,"xlink:href",bo)}else{bu.setAttribute(bq,bo)}}if(bs==0){t[bs]=this.getBBox(bu)}if(bu.nodeName=="text"){if((bo+"").indexOf("url")==0||$.inArray(bq,["font-size","font-family","x","y"])!=-1){bu=g(bu)}}if($.inArray(bu,aO)!=-1){setTimeout(function(){if(!bu.parentNode){return}F.requestSelector(bu).resize()},0)}var bt=bb.getRotationAngle(bu);if(bt!=0&&bq!="transform"){var bm=bb.getTransformList(bu);var bp=bm.numberOfItems;while(bp--){var bh=bm.getItem(bp);if(bh.type==4){bm.removeItem(bp);var bn=bb.getBBox(bu);var bx=P(bn.x+bn.width/2,bn.y+bn.height/2,r(bm).matrix);var bi=bx.x,bg=bx.y;var bw=G.createSVGTransform();bw.setRotate(bt,bi,bg);bm.insertItemBefore(bw,bp);break}}}}}G.unsuspendRedraw(bv)};this.finishUndoableChange=function(){var bk=aR--;var bl=a0[bk];var bh=bl.elements.length;var bg=bl.attrName;var bf=new ay("Change "+bg);while(bh--){var bj=bl.elements[bh];if(bj==null){continue}var bi={};bi[bg]=bl.oldValues[bh];if(bi[bg]!=bj.getAttribute(bg)){bf.addSubCommand(new au(bj,bi,bg))}}a0[bk]=null;return bf};this.changeSelectedAttribute=function(bf,bj,bh){var bh=bh||aO;bb.beginUndoableChange(bf,bh);var bi=bh.length;bb.changeSelectedAttributeNoUndo(bf,bj,bh);var bg=bb.finishUndoableChange();if(!bg.isEmpty()){aQ(bg)}};this.deleteSelectedElements=function(){var bh=new ay("Delete Elements");var bg=aO.length;var bf=[];for(var bj=0;bj<bg;++bj){var bl=aO[bj];if(bl==null){break}var bk=bl.parentNode;var bi=bl;F.releaseSelector(bi);var bm=bk.removeChild(bi);bf.push(bl);aO[bj]=null;bh.addSubCommand(new R(bm,bk))}if(!bh.isEmpty()){aQ(bh)}ah("changed",bf);bb.clearSelection()};this.groupSelectedElements=function(){var bf=new ay("Group Elements");var bj=c({element:"g",attr:{id:a6()}});bf.addSubCommand(new a(bj));var bh=aO.length;while(bh--){var bi=aO[bh];if(bi==null){continue}var bk=bi.nextSibling;var bg=bi.parentNode;bj.appendChild(bi);bf.addSubCommand(new S(bi,bk,bg))}if(!bf.isEmpty()){aQ(bf)}bb.clearSelection();bb.addToSelection([bj],true)};this.ungroupSelectedElement=function(){var bN=aO[0];if(bN.tagName=="g"){var bf=new ay("Ungroup Elements");var bn=bN.parentNode;var bi=bN.previousSibling;var bu=new Array(bN.childNodes.length);var bH=bN.getAttribute("transform");var bo=bb.getTransformList(bN);var bJ=r(bo).matrix;var bM=0;var bA=bb.getRotationAngle(bN);var bv=$(bN).attr(["filter","opacity"]);var bL,bj;while(bN.firstChild){var bI=bN.firstChild;var bB=bI.nextSibling;var bD=bI.parentNode;bu[bM++]=bI=bn.insertBefore(bI,bi);bf.addSubCommand(new S(bI,bB,bD));if(bv.opacity!==null&&bv.opacity!==1){var bQ=bI.getAttribute("opacity")||1;var bk=Math.round((bI.getAttribute("opacity")||1)*bv.opacity*100)/100;this.changeSelectedAttribute("opacity",bk,[bI])}if(bv.filter){var bp=this.getBlur(bI);var bt=bp;if(!bj){bj=this.getBlur(bN)}if(bp){bp=(bj-0)+(bp-0)}else{if(bp===0){bp=bj}}if(!bt){if(!bL){bL=b(am(bv.filter).substr(1))}else{bL=aq(bL);aB().appendChild(bL)}}else{bL=b(am(bI.getAttribute("filter")).substr(1))}var bK=(bL.firstChild.tagName==="feGaussianBlur")?"blur":"filter";bL.id=bI.id+"_"+bK;this.changeSelectedAttribute("filter","url(#"+bL.id+")",[bI]);if(bp){this.changeSelectedAttribute("stdDeviation",bp,[bL.firstChild]);bb.setBlurOffsets(bL,bp)}}var bC=bb.getTransformList(bI);if(bo.numberOfItems){if(bA&&bo.numberOfItems==1){var bg=bo.getItem(0).matrix;var bs=G.createSVGMatrix();var bz=bb.getRotationAngle(bI);if(bz){bs=bC.getItem(0).matrix}var bG=bb.getBBox(bI);var bO=r(bC).matrix;var br=P(bG.x+bG.width/2,bG.y+bG.height/2,bO);var bE=bA+bz;var bq=G.createSVGTransform();bq.setRotate(bE,br.x,br.y);var bl=ag(bg,bs,bq.matrix.inverse());if(bz){bC.removeItem(0)}if(bE){bC.insertItemBefore(bq,0)}if(bl.e||bl.f){var bP=G.createSVGTransform();bP.setTranslate(bl.e,bl.f);bC.insertItemBefore(bP,0)}}else{var bw=bI.getAttribute("transform");var bx={};bx.transform=bw?bw:"";var bh=G.createSVGTransform();var by=r(bC).matrix,bF=by.inverse();var bm=ag(bF,bJ,by);bh.setMatrix(bm);bC.appendItem(bh)}bf.addSubCommand(l(bI))}}if(bH){var bx={};bx.transform=bH;bN.setAttribute("transform","");bN.removeAttribute("transform");bf.addSubCommand(new au(bN,bx))}bb.clearSelection();bN=bn.removeChild(bN);bf.addSubCommand(new R(bN,bn));if(!bf.isEmpty()){aQ(bf)}bb.addToSelection(bu)}};this.moveToTopSelectedElement=function(){var bh=aO[0];if(bh!=null){var bg=bh;var bf=bg.parentNode;var bi=bg.nextSibling;if(bi==F.selectorParentGroup){bi=null}bg=bg.parentNode.appendChild(bg);aQ(new S(bg,bi,bf,"top"))}};this.moveToBottomSelectedElement=function(){var bh=aO[0];if(bh!=null){var bg=bh;var bf=bg.parentNode;var bj=bg.nextSibling;if(bj==F.selectorParentGroup){bj=null}var bi=bg.parentNode.firstChild;if(bi.tagName=="title"){bi=bi.nextSibling}if(bi.tagName=="defs"){bi=bi.nextSibling}bg=bg.parentNode.insertBefore(bg,bi);aQ(new S(bg,bj,bf,"bottom"))}};this.moveSelectedElements=function(bn,bm,bk){if(bn.constructor!=Array){bn/=ad;bm/=ad}var bk=bk||true;var bg=new ay("position");var bi=aO.length;while(bi--){var bh=aO[bi];if(bh!=null){if(bi==0){t[bi]=this.getBBox(bh)}var bl=G.createSVGTransform();var bj=bb.getTransformList(bh);if(bn.constructor==Array){if(bi==0){t[bi].x+=bn[bi];t[bi].y+=bm[bi]}bl.setTranslate(bn[bi],bm[bi])}else{if(bi==0){t[bi].x+=bn;t[bi].y+=bm}bl.setTranslate(bn,bm)}bj.insertItemBefore(bl,0);var bf=l(bh);if(bf){bg.addSubCommand(bf)}F.requestSelector(bh).resize()}}if(!bg.isEmpty()){if(bk){aQ(bg)}ah("changed",aO);return bg}};var ba=function(bu){var bz=bu.pathSegList;var bs=bz.numberOfItems;var bm=[[],[]];var bl=bz.getItem(0);var bk=[bl.x,bl.y];for(var bw=0;bw<bs;bw++){var by=bz.getItem(bw);if(!by.x){continue}bm[0].push(bk[0]);bm[1].push(bk[1]);if(by.x1){var bj=[by.x1,by.y1],bi=[by.x2,by.y2],bg=[by.x,by.y];for(var bv=0;bv<2;bv++){var bf=function(bD){return Math.pow(1-bD,3)*bk[bv]+3*Math.pow(1-bD,2)*bD*bj[bv]+3*(1-bD)*Math.pow(bD,2)*bi[bv]+Math.pow(bD,3)*bg[bv]};var bB=6*bk[bv]-12*bj[bv]+6*bi[bv];var bC=-3*bk[bv]+9*bj[bv]-9*bi[bv]+3*bg[bv];var bA=3*bj[bv]-3*bk[bv];if(bC==0){if(bB==0){continue}var bt=-bA/bB;if(0<bt&&bt<1){bm[bv].push(bf(bt))}continue}var bh=Math.pow(bB,2)-4*bA*bC;if(bh<0){continue}var bq=(-bB+Math.sqrt(bh))/(2*bC);if(0<bq&&bq<1){bm[bv].push(bf(bq))}var bo=(-bB-Math.sqrt(bh))/(2*bC);if(0<bo&&bo<1){bm[bv].push(bf(bo))}}bk=bg}else{bm[0].push(by.x);bm[1].push(by.y)}}var bp=Math.min.apply(null,bm[0]);var br=Math.max.apply(null,bm[0])-bp;var bn=Math.min.apply(null,bm[1]);var bx=Math.max.apply(null,bm[1])-bn;return{x:bp,y:bn,width:br,height:bx}};this.contentW=this.getResolution().w;this.contentH=this.getResolution().h;this.updateCanvas=function(bo,bi,bf,bj){G.setAttribute("width",bo);G.setAttribute("height",bi);var bh=$("#canvasBackground")[0];var bl=aj.getAttribute("x");var bk=aj.getAttribute("y");var bn=(bo/2-this.contentW*ad/2);var bm=(bi/2-this.contentH*ad/2);ax(aj,{width:this.contentW*ad,height:this.contentH*ad,x:bn,y:bm,viewBox:"0 0 "+this.contentW+" "+this.contentH});ax(bh,{width:aj.getAttribute("width"),height:aj.getAttribute("height"),x:bn,y:bm});F.selectorParentGroup.setAttribute("transform","translate("+bn+","+bm+")");return{x:bn,y:bm,old_x:bl,old_y:bk,d_x:bn-bl,d_y:bm-bk}};this.getStrokedBBox=function(bg){if(!bg){bg=bb.getVisibleElements()}if(!bg.length){return false}var bh=function(bq){try{var bv=bb.getBBox(bq);var br=bb.getRotationAngle(bq);if((br&&br%90)||aN(bb.getTransformList(bq))){var bu=false;var bx=["ellipse","path","line","polyline","polygon"];if($.inArray(bq.tagName,bx)!=-1){bv=bu=bb.convertToPath(bq,true,br)}else{if(bq.tagName=="rect"){var bp=bq.getAttribute("rx");var bo=bq.getAttribute("ry");if(bp||bo){bv=bu=bb.convertToPath(bq,true,br)}}}if(!bu){var bs=document.createElementNS(aI,"g");var bw=bq.parentNode;bw.replaceChild(bs,bq);bs.appendChild(bq);bv=bs.getBBox();bw.insertBefore(bq,bs);bw.removeChild(bs)}}return bv}catch(bt){console.log(bq,bt);return null}};var bl;$.each(bg,function(){if(bl){return}if(!this.parentNode){return}bl=bh(this)});if(bl==null){return null}var bf=bl.x+bl.width;var bn=bl.y+bl.height;var bk=bl.x;var bj=bl.y;var bm=function(bp){var bo=bp.getAttribute("stroke-width");var bq=0;if(bp.getAttribute("stroke")!="none"&&!isNaN(bo)){bq+=bo/2}return bq};var bi=[];$.each(bg,function(bp,bq){var bo=bh(bq);if(bo){var br=bm(bq);bk=Math.min(bk,bo.x-br);bj=Math.min(bj,bo.y-br);bi.push(bo)}});bl.x=bk;bl.y=bj;$.each(bg,function(bp,bq){var bo=bi[bp];if(bo&&bq.nodeType==1){var br=bm(bq);bf=Math.max(bf,bo.x+bo.width+br);bn=Math.max(bn,bo.y+bo.height+br)}});bl.width=bf-bk;bl.height=bn-bj;return bl};this.getVisibleElements=function(bf,bg){if(!bf){bf=$(aj).children()}var bh=[];$(bf).children().each(function(bi,bl){try{var bk=bl.getBBox();if(bk){var bj=bg?{elem:bl,bbox:bb.getStrokedBBox([bl])}:bl;bh.push(bj)}}catch(bm){}});return bh.reverse()};this.cycleElement=function(bh){var bk=aO[0];var bi=false;var bj=this.getVisibleElements(W);if(bk==null){var bf=bh?bj.length-1:0;bi=bj[bf]}else{var bg=bj.length;while(bg--){if(bj[bg]==bk){var bf=bh?bg-1:bg+1;if(bf>=bj.length){bf=0}else{if(bf<0){bf=bj.length-1}}bi=bj[bf];break}}}bb.clearSelection();bb.addToSelection([bi],true);ah("selected",aO)};var aH=function(){T=[];aM=0};this.getUndoStackSize=function(){return aM};this.getRedoStackSize=function(){return T.length-aM};this.getNextUndoCommandText=function(){if(aM>0){return T[aM-1].text}return""};this.getNextRedoCommandText=function(){if(aM<T.length){return T[aM].text}return""};this.undo=function(){if(aM>0){this.clearSelection();var bf=T[--aM];bf.unapply();w.clear();ah("changed",bf.elements())}};this.redo=function(){if(aM<T.length&&T.length>0){this.clearSelection();var bf=T[aM++];bf.apply();w.clear();ah("changed",bf.elements())}};var aq=function(bg){var bh=document.createElementNS(bg.namespaceURI,bg.nodeName);$.each(bg.attributes,function(bj,bi){if(bi.localName!="-moz-math-font-style"){bh.setAttributeNS(bi.namespaceURI,bi.nodeName,bi.nodeValue)}});bh.removeAttribute("id");bh.id=a6();a4++;if((aA||!aZ.goodDecimals)&&bg.nodeName=="path"){var bf=w.convertPath(bg);bh.setAttribute("d",bf)}$.each(bg.childNodes,function(bi,bj){switch(bj.nodeType){case 1:bh.appendChild(aq(bj));break;case 3:bh.textContent=bj.nodeValue;break;default:break}});if(bh.tagName=="image"){aU(bh)}return bh};var aU=function(bf){$(bf).click(function(bg){bg.preventDefault()})};this.cloneSelectedElements=function(){var bg=new ay("Clone Elements");var bf=aO.length;for(var bh=0;bh<bf;++bh){var bj=aO[bh];if(bj==null){break}}var bi=aO.slice(0,bh);this.clearSelection();var bh=bi.length;while(bh--){var bj=bi[bh]=aq(bi[bh]);W.appendChild(bj);bg.addSubCommand(new a(bj))}if(!bg.isEmpty()){this.addToSelection(bi.reverse());this.moveSelectedElements(20,20,false);aQ(bg);ah("selected",aO)}};this.setBackground=function(bf,bi){var bj=b("canvasBackground");var bh=$(bj).find("rect")[0];var bk=b("background_image");bh.setAttribute("fill",bf);if(bi){if(!bk){bk=aK.createElementNS(aI,"image");ax(bk,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}bk.setAttributeNS(aC,"xlink:href",bi);bj.appendChild(bk)}else{if(bk){bk.parentNode.removeChild(bk)}}};this.alignSelectedElements=function(bn,bt){var bi=[],bl=[];var br=Number.MAX_VALUE,bm=Number.MIN_VALUE,bp=Number.MAX_VALUE,bk=Number.MIN_VALUE;var bo=Number.MIN_VALUE,bj=Number.MIN_VALUE;var bh=aO.length;if(!bh){return}for(var bg=0;bg<bh;++bg){if(aO[bg]==null){break}var bf=aO[bg];bi[bg]=bb.getStrokedBBox([bf]);switch(bt){case"smallest":if((bn=="l"||bn=="c"||bn=="r")&&(bo==Number.MIN_VALUE||bo>bi[bg].width)||(bn=="t"||bn=="m"||bn=="b")&&(bj==Number.MIN_VALUE||bj>bi[bg].height)){br=bi[bg].x;bp=bi[bg].y;bm=bi[bg].x+bi[bg].width;bk=bi[bg].y+bi[bg].height;bo=bi[bg].width;bj=bi[bg].height}break;case"largest":if((bn=="l"||bn=="c"||bn=="r")&&(bo==Number.MIN_VALUE||bo<bi[bg].width)||(bn=="t"||bn=="m"||bn=="b")&&(bj==Number.MIN_VALUE||bj<bi[bg].height)){br=bi[bg].x;bp=bi[bg].y;bm=bi[bg].x+bi[bg].width;bk=bi[bg].y+bi[bg].height;bo=bi[bg].width;bj=bi[bg].height}break;default:if(bi[bg].x<br){br=bi[bg].x}if(bi[bg].y<bp){bp=bi[bg].y}if(bi[bg].x+bi[bg].width>bm){bm=bi[bg].x+bi[bg].width}if(bi[bg].y+bi[bg].height>bk){bk=bi[bg].y+bi[bg].height}break}}if(bt=="page"){br=0;bp=0;bm=bb.contentW;bk=bb.contentH}var bu=new Array(bh);var bs=new Array(bh);for(var bg=0;bg<bh;++bg){if(aO[bg]==null){break}var bf=aO[bg];var bq=bi[bg];bu[bg]=0;bs[bg]=0;switch(bn){case"l":bu[bg]=br-bq.x;break;case"c":bu[bg]=(br+bm)/2-(bq.x+bq.width/2);break;case"r":bu[bg]=bm-(bq.x+bq.width);break;case"t":bs[bg]=bp-bq.y;break;case"m":bs[bg]=(bp+bk)/2-(bq.y+bq.height/2);break;case"b":bs[bg]=bk-(bq.y+bq.height);break}}this.moveSelectedElements(bu,bs)};this.getZoom=function(){return ad};this.getVersion=function(){return"svgcanvas.js ($Rev: 1600 $)"};this.setUiStrings=function(bf){$.extend(az,bf)};this.setConfig=function(bf){$.extend(J,bf)};this.clear();function b(bf){if(G.querySelector){return G.querySelector("#"+bf)}else{if(aK.evaluate){return aK.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+bf+'"]',aJ,function(){return"http://www.w3.org/2000/svg"},9,null).singleNodeValue}else{return $(G).find("[id="+bf+"]")[0]}}}this.getPrivateMethods=function(){return{addCommandToHistory:aQ,addGradient:C,addSvgElementFromJson:c,assignAttributes:ax,BatchCommand:ay,call:ah,ChangeElementCommand:au,cleanupElement:ar,copyElem:aq,ffClone:g,findDefs:aB,findDuplicateGradient:s,fromXml:al,getElem:b,getId:A,getIntersectionList:aV,getMouseTarget:aa,getNextId:a6,getPathBBox:ba,getUrlFromAttr:am,hasMatrixTransform:aN,identifyLayers:Z,InsertElementCommand:a,isIdentity:a8,logMatrix:av,matrixMultiply:ag,MoveElementCommand:S,preventClickDefault:aU,recalculateAllSelectedDimensions:aY,recalculateDimensions:l,remapElement:B,RemoveElementCommand:R,removeUnusedDefElems:u,resetUndoStack:aH,round:Q,runExtensions:aG,sanitizeSvg:M,Selector:aW,SelectorManager:bc,shortFloat:a3,svgCanvasToString:i,SVGEditTransformList:H,svgToString:aS,toString:toString,toXml:d,transformBox:bd,transformListToTransform:r,transformPoint:P,transformToObj:af,walkTree:at}};this.addExtension=function(bf,bh){if(!(bf in e)){var bg=bh($.extend(bb.getPrivateMethods(),{svgroot:G,svgcontent:aj,nonce:m,selectorManager:F}));e[bf]=bg;ah("extension_added",bg)}else{console.log('Cannot add extension "'+bf+'", an extension by that name already exists"')}};(function(){var bk=document.createElementNS(aI,"path");bk.setAttribute("d","M0,0 10,10");var bg=bk.pathSegList;var bf=bk.createSVGPathSegLinetoAbs(5,5);try{bg.replaceItem(bf,0);aZ.pathReplaceItem=true}catch(bj){aZ.pathReplaceItem=false}try{bg.insertItemBefore(bf,0);aZ.pathInsertItemBefore=true}catch(bj){aZ.pathInsertItemBefore=false}aZ.editableText=k;var bi=document.createElementNS(aI,"rect");bi.setAttribute("x",0.1);var bh=bi.cloneNode(false);aZ.goodDecimals=(bh.getAttribute("x").indexOf(",")==-1);var bi=document.createElementNS(aI,"rect");bi.setAttribute("width","1em");bi.setAttribute("height","1ex");aj.appendChild(bi);var bl=bi.getBBox();I.em=bl.width;I.ex=bl.height;aj.removeChild(bi)}())};var Utils={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(d){d=Utils.convertToXMLReferences(d);if(window.btoa){return window.btoa(d)}var b=new Array(Math.floor((d.length+2)/3)*4);var l,j,g;var k,h,f,e;var c=0,a=0;do{l=d.charCodeAt(c++);j=d.charCodeAt(c++);g=d.charCodeAt(c++);k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64}else{if(isNaN(g)){e=64}}b[a++]=this._keyStr.charAt(k);b[a++]=this._keyStr.charAt(h);b[a++]=this._keyStr.charAt(f);b[a++]=this._keyStr.charAt(e)}while(c<d.length);return b.join("")},decode64:function(c){if(window.atob){return window.atob(c)}var a="";var k,h,f="";var j,g,e,d="";var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}k=h=f="";j=g=e=d=""}while(b<c.length);return unescape(a)},encodeUTF8:function(b){var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=b[e]}else{if(d>127){if(d<2048){a+=String.fromCharCode((d>>6)|192)}else{a+=String.fromCharCode((d>>12)|224)+String.fromCharCode((d>>6)&63|128)}a+=String.fromCharCode((d&63)|128)}}}return a},convertToXMLReferences:function(b){var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=b[e]}else{if(d>127){a+=("&#"+d+";")}}}return a},rectsIntersect:function(b,a){return a.x<(b.x+b.width)&&(a.x+a.width)>b.x&&a.y<(b.y+b.height)&&(a.y+a.height)>b.y},snapToAngle:function(b,j,a,h){var d=Math.PI/4;var l=a-b;var k=h-j;var c=Math.atan2(k,l);var f=Math.sqrt(l*l+k*k);var e=Math.round(c/d)*d;var i=b+f*Math.cos(e);var g=j+f*Math.sin(e);return{x:i,y:g,a:e}},text2xml:function(b){var a;try{var d=($.browser.msie)?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser();d.async=false}catch(c){throw new Error("XML Parser could not be instantiated")}try{if($.browser.msie){a=(d.loadXML(b))?d:false}else{a=d.parseFromString(b,"text/xml")}}catch(c){throw new Error("Error parsing XML string")}return a}};