if(!window.console){window.console=new function(){this.log=function(a){};this.dir=function(a){}}}function ChangeElementCommand(b,a,c){this.elem=b;this.text=c?("Change "+b.tagName+" "+c):("Change "+b.tagName);this.newValues={};this.oldValues=a;for(attr in a){if(attr=="#text"){this.newValues[attr]=b.textContent}else{this.newValues[attr]=b.getAttribute(attr)}}this.apply=function(){for(attr in this.newValues){if(this.newValues[attr]){if(attr=="#text"){this.elem.textContent=this.newValues[attr]}else{this.elem.setAttribute(attr,this.newValues[attr])}}else{if(attr!="#text"){this.elem.textContent=""}else{this.elem.removeAttribute(attr)}}}return true};this.unapply=function(){for(attr in this.oldValues){if(this.oldValues[attr]){if(attr=="#text"){this.elem.textContent=this.oldValues[attr]}else{this.elem.setAttribute(attr,this.oldValues[attr])}}else{if(attr=="#text"){this.elem.textContent=""}else{this.elem.removeAttribute(attr)}}}return true};this.elements=function(){return[this.elem]}}function InsertElementCommand(a,b){this.elem=a;this.text=b||("Create "+a.tagName);this.parent=a.parentNode;this.apply=function(){this.elem=this.parent.insertBefore(this.elem,this.elem.nextSibling)};this.unapply=function(){this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem)};this.elements=function(){return[this.elem]}}function RemoveElementCommand(b,a,c){this.elem=b;this.text=c||("Delete "+b.tagName);this.parent=a;this.apply=function(){this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem)};this.unapply=function(){this.elem=this.parent.insertBefore(this.elem,this.elem.nextSibling)};this.elements=function(){return[this.elem]}}function MoveElementCommand(b,c,a,d){this.elem=b;this.text=d?("Move "+b.tagName+" to "+d):("Move "+b.tagName+"top/bottom");this.oldNextSibling=c;this.oldParent=a;this.newNextSibling=b.nextSibling;this.newParent=b.parentNode;this.apply=function(){this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling)};this.unapply=function(){this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling)};this.elements=function(){return[this.elem]}}function BatchCommand(a){this.elems=[];this.text=a||"Batch Command";this.stack=[];this.apply=function(){var b=this.stack.length;for(var c=0;c<b;++c){this.stack[c].apply()}};this.unapply=function(){for(var b=this.stack.length-1;b>=0;b--){this.stack[b].unapply()}};this.elements=function(){return this.elems};this.addSubCommand=function(b){this.stack.push(b)};this.isEmpty=function(){return this.stack.length==0}}function SvgCanvas(X){function E(ab,c){this.id=ab;this.selectedElement=c;this.locked=true;this.reset=function(ac){this.locked=true;this.selectedElement=ac;this.resize();this.selectorGroup.setAttribute("display","inline")};this.selectorGroup=f({element:"g",attr:{id:("selectorGroup"+this.id)}});this.selectorRect=this.selectorGroup.appendChild(f({element:"rect",attr:{id:("selectedBox"+this.id),fill:"none",stroke:"blue","stroke-width":"1","stroke-dasharray":"5,5",width:1,height:1,style:"pointer-events:none",}}));this.selectorGrips={nw:null,n:null,ne:null,w:null,e:null,sw:null,s:null,se:null,};for(dir in this.selectorGrips){this.selectorGrips[dir]=this.selectorGroup.appendChild(f({element:"rect",attr:{id:("selectorGrip_"+dir+"_"+this.id),fill:"blue",width:6,height:6,style:("cursor:"+dir+"-resize"),"stroke-width":2,"pointer-events":"all",display:"none"}}));$("#"+this.selectorGrips[dir].id).mousedown(function(){S="resize";N=this.id.substr(13,this.id.indexOf("_",13)-13)})}this.showGrips=function(ac){for(dir in this.selectorGrips){this.selectorGrips[dir].setAttribute("display",ac?"inline":"none")}};this.resize=function(aj){var ac=this.selectorRect;var ak=this.selectorGrips;var af=this.selectedElement;var ai=parseInt(af.getAttribute("stroke-width"));var ae=1;if(!isNaN(ai)){ae+=ai/2}if(af.tagName=="text"){ae+=2}var aj=aj||this.selectedElement.getBBox();var ad=aj.x-ae,al=aj.y-ae,ah=aj.width+(ae<<1),ag=aj.height+(ae<<1);ac.x.baseVal.value=ad;ac.y.baseVal.value=al;ac.width.baseVal.value=ah;ac.height.baseVal.value=ag;ak.nw.x.baseVal.value=ad-3;ak.nw.y.baseVal.value=al-3;ak.ne.x.baseVal.value=ad+ah-3;ak.ne.y.baseVal.value=al-3;ak.sw.x.baseVal.value=ad-3;ak.sw.y.baseVal.value=al+ag-3;ak.se.x.baseVal.value=ad+ah-3;ak.se.y.baseVal.value=al+ag-3;ak.n.x.baseVal.value=ad+ah/2-3;ak.n.y.baseVal.value=al-3;ak.w.x.baseVal.value=ad-3;ak.w.y.baseVal.value=al+ag/2-3;ak.e.x.baseVal.value=ad+ah-3;ak.e.y.baseVal.value=al+ag/2-3;ak.s.x.baseVal.value=ad+ah/2-3;ak.s.y.baseVal.value=al+ag-3};this.reset(c)}function Z(){this.selectorParentGroup=null;this.rubberBandBox=null;this.selectors=[];this.selectorMap={};var ab=this;var c=function(){ab.selectorParentGroup=f({element:"g",attr:{id:"selectorParentGroup"}})};this.requestSelector=function(ad){if(ad==null){return null}var ae=this.selectors.length;if(this.selectorParentGroup==null){c()}if(typeof(this.selectorMap[ad.id])=="object"){this.selectorMap[ad.id].locked=true;return this.selectorMap[ad.id]}for(var ac=0;ac<ae;++ac){if(this.selectors[ac]&&!this.selectors[ac].locked){this.selectors[ac].locked=true;this.selectors[ac].reset(ad);this.selectorMap[ad.id]=this.selectors[ac];return this.selectors[ac]}}this.selectors[ae]=new E(ae,ad);this.selectorParentGroup.appendChild(this.selectors[ae].selectorGroup);this.selectorMap[ad.id]=this.selectors[ae];return this.selectors[ae]};this.releaseSelector=function(ad){if(ad==null){return}var ag=this.selectors.length;var ae=this.selectorMap[ad.id];for(var ac=0;ac<ag;++ac){if(this.selectors[ac]&&this.selectors[ac]==ae){if(ae.locked==false){console.log("WARNING! selector was released but was already unlocked")}delete this.selectorMap[ad.id];ae.locked=false;ae.selectedElement=null;ae.showGrips(false);try{ae.selectorGroup.setAttribute("display","none")}catch(af){}break}}};this.update=function(){if(this.selectorParentGroup==null){c()}this.selectorParentGroup=y.appendChild(this.selectorParentGroup)};this.getRubberBandBox=function(){if(this.selectorParentGroup==null){c()}if(this.rubberBandBox==null){this.rubberBandBox=this.selectorParentGroup.appendChild(f({element:"rect",attr:{id:"selectorRubberBand",fill:"blue","fill-opacity":0.15,stroke:"blue","stroke-width":0.5,display:"none",style:"pointer-events:none",}}))}return this.rubberBandBox}}var k=this;var G=X;var V="http://www.w3.org/2000/svg";var n="svg_";var w=X.ownerDocument;var y=w.createElementNS(V,"svg");y.setAttribute("width",640);y.setAttribute("height",480);y.setAttribute("id","svgroot");y.setAttribute("xmlns",V);G.appendChild(y);var W=null;var aa=false;var L=1;var J=null;var I=null;var S="select";var N="none";var d="none";var j="black";var e=1;var O="none";var T=1;var g=1;var t=1;var q="12pt";var p="serif";var R=null;var v=null;var P=null;var u=null;var b=new Array(1);var D=new Array(1);var B=new Z();var Q=null;var C=null;var x={};var M=0;var o=[];var A=function(ae){if(C==null){return null}var ab=null;try{ab=y.getIntersectionList(ae,null)}catch(af){}if(ab==null||typeof(ab.item)!="function"){ab=[];var ad=C.getBBox();var c=y.childNodes;var ac=y.childNodes.length;while(ac--){if(c[ac].id!="selectorParentGroup"&&Utils.rectsIntersect(ad,c[ac].getBBox())){ab.push(c[ac])}}}return ab};var z=function(c){if(M<o.length&&o.length>0){o=o.splice(0,M)}o.push(c);M=o.length};var Y=function(){if(x.getid){return a("getid",L)}return n+L};var a=function(ab,c){if(x[ab]){return x[ab](this,c)}};var F=function(ab,c){for(i in c){ab.setAttributeNS(null,i,c[i])}};var s=function(c){if(c.getAttribute("fill-opacity")=="1"){c.removeAttribute("fill-opacity")}if(c.getAttribute("opacity")=="1"){c.removeAttribute("opacity")}if(c.getAttribute("stroke")=="none"){c.removeAttribute("stroke")}if(c.getAttribute("stroke-dasharray")=="none"){c.removeAttribute("stroke-dasharray")}if(c.getAttribute("stroke-opacity")=="1"){c.removeAttribute("stroke-opacity")}if(c.getAttribute("stroke-width")=="1"){c.removeAttribute("stroke-width")}if(c.getAttribute("rx")=="0"){c.removeAttribute("rx")}if(c.getAttribute("ry")=="0"){c.removeAttribute("ry")}};var f=function(c){return k.updateElementFromJson(c)};var m=function(ac,ab){var ad="";if(ac){var ai=ac.attributes;var ag;var ae;var ah=ac.childNodes;for(ae=0;ae<ab;ae++){ad+=" "}ad+="<"+ac.nodeName;for(ae=ai.length-1;ae>=0;ae--){ag=ai.item(ae);if(ag.nodeValue!=""){ad+=" "+ag.nodeName+'="'+ag.nodeValue+'"'}}if(ac.hasChildNodes()){ad+=">";ab++;var af=false;for(ae=0;ae<ah.length;ae++){var c=ah.item(ae);if(c.id=="selectorParentGroup"){continue}if(c.nodeType==1){ad+="\n"+m(ah.item(ae),ab)}else{if(c.nodeType==3){af=true;ad+=c.nodeValue+""}}}ab--;if(!af){ad+="\n";for(ae=0;ae<ab;ae++){ad+=" "}}ad+="</"+ac.nodeName+">"}else{ad+="/>"}}return ad};var K=function(){var ad=(N=="none"?"position":"size");var c=new BatchCommand(ad);var ab=b.length;while(ab--){var ac=U(ab);if(ac){c.addSubCommand(ac)}}if(!c.isEmpty()){z(c);a("changed",b)}};var U=function(ao){var aj=b[ao];if(aj==null){return null}var ag=D[ao];var af=aj.getBBox();if(af.x==ag.x&&af.y==ag.y&&af.width==ag.width&&af.height==ag.height){return null}var ap=function(at){return((at-af.x)/af.width)*ag.width+ag.x};var an=function(at){return((at-af.y)/af.height)*ag.height+ag.y};var ab=function(at){return at*ag.width/af.width};var ah=function(at){return at*ag.height/af.height};var ar={};aj.setAttribute("transform","");aj.removeAttribute("transform");switch(aj.tagName){case"path":ar.d=aj.getAttribute("d");var ac=aj.pathSegList.getItem(0);var am=ac.x,ak=ac.y;var ai="M"+ap(am)+","+an(ak);var c=aj.pathSegList;var aq=c.numberOfItems;for(var ao=1;ao<aq;++ao){var al=c.getItem(ao);var ae=al.x,ad=al.y;if(al.pathSegType==4){ae-=am;ad-=ak;am+=ae;ak+=ad}ai+=" l"+ab(ae)+","+ah(ad)}aj.setAttributeNS(null,"d",ai);break;case"line":ar.x1=aj.x1.baseVal.value;ar.y1=aj.y1.baseVal.value;ar.x2=aj.x2.baseVal.value;ar.y2=aj.y2.baseVal.value;aj.x1.baseVal.value=ap(aj.x1.baseVal.value);aj.y1.baseVal.value=an(aj.y1.baseVal.value);aj.x2.baseVal.value=ap(aj.x2.baseVal.value);aj.y2.baseVal.value=an(aj.y2.baseVal.value);break;case"circle":ar.cx=aj.cx.baseVal.value;ar.cy=aj.cy.baseVal.value;ar.r=aj.r.baseVal.value;aj.cx.baseVal.value=ap(aj.cx.baseVal.value);aj.cy.baseVal.value=an(aj.cy.baseVal.value);aj.r.baseVal.value=Math.min(ag.width/2,ag.height/2);break;case"ellipse":ar.cx=aj.cx.baseVal.value;ar.cy=aj.cy.baseVal.value;ar.rx=aj.rx.baseVal.value;ar.ry=aj.ry.baseVal.value;aj.cx.baseVal.value=ap(aj.cx.baseVal.value);aj.cy.baseVal.value=an(aj.cy.baseVal.value);aj.rx.baseVal.value=ab(aj.rx.baseVal.value);aj.ry.baseVal.value=ah(aj.ry.baseVal.value);break;case"text":ar.x=aj.getAttribute("x");ar.y=aj.getAttribute("y");aj.setAttribute("x",ap(aj.getAttribute("x")));aj.setAttribute("y",an(aj.getAttribute("y")));break;case"rect":ar.x=aj.x.baseVal.value;ar.y=aj.y.baseVal.value;ar.width=aj.width.baseVal.value;ar.height=aj.height.baseVal.value;aj.x.baseVal.value=ap(aj.x.baseVal.value);aj.y.baseVal.value=an(aj.y.baseVal.value);aj.width.baseVal.value=ab(aj.width.baseVal.value);aj.height.baseVal.value=ah(aj.height.baseVal.value);break;default:console.log("Unknown shape type: "+aj.tagName);break}if(ar){return new ChangeElementCommand(aj,ar)}};this.clearSelection=function(){if(b[0]==null){return}var c=b.length;for(var ab=0;ab<c;++ab){var ac=b[ab];if(ac==null){break}B.releaseSelector(ac);b[ab]=null;D[ab]=null}a("selected",b)};this.addToSelection=function(c){if(c.length==0){return}var ab=0;while(ab<b.length){if(b[ab]==null){break}++ab}var ac=c.length;while(ac--){var ad=c[ac];if(ad.id.substr(0,13)=="selectorGrip_"){continue}if(b.indexOf(ad)==-1){b[ab]=ad;D[ab++]=ad.getBBox();B.requestSelector(ad);a("selected",b)}}};this.removeFromSelection=function(ab){if(b[0]==null){return}if(ab.length==0){return}var ae=new Array(b.length);var ac=0;var c=b.length;for(var ad=0;ad<c;++ad){var af=b[ad];if(af){if(ab.indexOf(af)==-1){ae[ac++]=af}else{B.releaseSelector(af)}}}b=ae};var l=function(ab){var c=ab.pageX-G.parentNode.offsetLeft+G.parentNode.scrollLeft;var af=ab.pageY-G.parentNode.offsetTop+G.parentNode.scrollTop;switch(S){case"select":aa=true;J=c;I=af;N="none";var ac=ab.target;var ae=ac.nodeName.toLowerCase();if(ae!="div"&&ae!="svg"){if(b.indexOf(ac)==-1){k.clearSelection();k.addToSelection([ac])}}else{k.clearSelection();S="multiselect";if(C==null){C=B.getRubberBandBox()}C.x.baseVal.value=J;C.y.baseVal.value=I;C.width.baseVal.value=0;C.height.baseVal.value=0;C.setAttribute("display","inline")}break;case"resize":aa=true;J=c;I=af;break;case"fhellipse":case"fhrect":case"path":aa=true;J=c;I=af;W="M"+c+","+af+" ";f({element:"path",attr:{d:W,id:Y(),fill:"none",stroke:j,"stroke-width":e,"stroke-dasharray":O,"stroke-opacity":g,opacity:T/2}});R=c;v=c;P=af;u=af;break;case"square":case"rect":aa=true;J=c;I=af;f({element:"rect",attr:{x:c,y:af,width:0,height:0,id:Y(),fill:d,stroke:j,"stroke-width":e,"stroke-dasharray":O,"stroke-opacity":g,"fill-opacity":t,opacity:T/2}});break;case"line":aa=true;f({element:"line",attr:{x1:c,y1:af,x2:c,y2:af,id:Y(),stroke:j,"stroke-width":e,"stroke-dasharray":O,"stroke-opacity":g,fill:"none",opacity:T/2}});break;case"circle":aa=true;f({element:"circle",attr:{cx:c,cy:af,r:0,id:Y(),fill:d,stroke:j,"stroke-width":e,"stroke-dasharray":O,"stroke-opacity":g,"fill-opacity":t,opacity:T/2}});break;case"ellipse":aa=true;f({element:"ellipse",attr:{cx:c,cy:af,rx:0,ry:0,id:Y(),fill:d,stroke:j,"stroke-width":e,"stroke-dasharray":O,"stroke-opacity":g,"fill-opacity":t,opacity:T/2}});break;case"text":aa=true;var ad=f({element:"text",attr:{x:c,y:af,id:Y(),fill:d,stroke:j,"stroke-width":e,"stroke-dasharray":O,"stroke-opacity":g,"fill-opacity":t,opacity:T,"font-size":q,"font-family":p,}});ad.textContent="text";break}};var r=function(am){if(!aa){return}var ar=b[0];var ag=am.pageX-G.parentNode.offsetLeft+G.parentNode.scrollLeft;var af=am.pageY-G.parentNode.offsetTop+G.parentNode.scrollTop;var ab=w.getElementById(Y());switch(S){case"select":if(b[0]!=null){var ak=ag-J;var ai=af-I;var c=["translate(",ak,",",ai,")"].join("");var av=b.length;for(var au=0;au<av;++au){var ar=b[au];if(ar==null){break}ar.setAttribute("transform",c);var ah=ar.getBBox();ah.x+=ak;ah.y+=ai;B.requestSelector(ar).resize(ah);D[au]=ah}}break;case"multiselect":C.x.baseVal.value=Math.min(J,ag);C.y.baseVal.value=Math.min(I,af);C.width.baseVal.value=Math.abs(ag-J);C.height.baseVal.value=Math.abs(af-I);k.clearSelection();k.addToSelection(A());break;case"resize":var ah=ar.getBBox(),ae=ah.x,an=ah.y,at=ah.width,aq=ah.height,ak=(ag-J),ai=(af-I);var ax=0,aw=0,ap=1,al=1;var c=null;if(N.indexOf("n")!=-1){aw=ai;al=(aq-ai)/aq}else{if(N.indexOf("s")!=-1){al=(aq+ai)/aq}}if(N.indexOf("e")!=-1){ap=(at+ak)/at}else{if(N.indexOf("w")!=-1){ax=ak;ap=(at-ak)/at}}var aj=D[0];aj.x=ae+ax;aj.y=an+aw;aj.width=at*ap;aj.height=aq*al;if(aj.width<0){aj.x+=aj.width;aj.width=-aj.width}if(aj.height<0){aj.y+=aj.height;aj.height=-aj.height}ar.setAttribute("transform",("translate("+(ae+ax)+","+(an+aw)+") scale("+(ap)+","+(al)+") translate("+(-ae)+","+(-an)+")"));B.requestSelector(ar).resize(aj);break;case"text":ab.setAttribute("x",ag);ab.setAttribute("y",af);break;case"line":ab.setAttributeNS(null,"x2",ag);ab.setAttributeNS(null,"y2",af);break;case"square":var ao=Math.max(Math.abs(ag-J),Math.abs(af-I));ab.setAttributeNS(null,"width",ao);ab.setAttributeNS(null,"height",ao);ab.setAttributeNS(null,"x",J<ag?J:J-ao);ab.setAttributeNS(null,"y",I<af?I:I-ao);break;case"rect":ab.setAttributeNS(null,"x",Math.min(J,ag));ab.setAttributeNS(null,"y",Math.min(I,af));ab.setAttributeNS(null,"width",Math.abs(ag-J));ab.setAttributeNS(null,"height",Math.abs(af-I));break;case"circle":var ad=ab.getAttributeNS(null,"cx");var ac=ab.getAttributeNS(null,"cy");var ay=Math.sqrt((ag-ad)*(ag-ad)+(af-ac)*(af-ac));ab.setAttributeNS(null,"r",ay);break;case"ellipse":var ad=ab.getAttributeNS(null,"cx");var ac=ab.getAttributeNS(null,"cy");ab.setAttributeNS(null,"rx",Math.abs(ag-ad));ab.setAttributeNS(null,"ry",Math.abs(af-ac));break;case"fhellipse":case"fhrect":R=Math.min(ag,R);v=Math.max(ag,v);P=Math.min(af,P);u=Math.max(af,u);case"path":var ak=ag-J;var ai=af-I;J=ag;I=af;W+="l"+ak+","+ai+" ";ab.setAttributeNS(null,"d",W);break}};var h=function(c){if(!aa){return}aa=false;var ad=w.getElementById(Y());var ab=false;switch(S){case"resize":case"multiselect":if(C!=null){C.setAttribute("display","none")}S="select";case"select":if(b[0]!=null){if(b[1]==null){var ae=b[0];d=ae.getAttribute("fill");t=ae.getAttribute("fill-opacity");j=ae.getAttribute("stroke");g=ae.getAttribute("stroke-opacity");e=ae.getAttribute("stroke-width");O=ae.getAttribute("stroke-dasharray");if(ae.tagName=="text"){q=ae.getAttribute("font-size");p=ae.getAttribute("font-family")}B.requestSelector(ae).showGrips(ae.tagName!="text")}K();var ac=b.length;while(ac--){B.requestSelector(b[ac]).resize(D[ac])}return}break;case"path":ab=true;break;case"line":ab=(ad.getAttribute("x1")!=ad.getAttribute("x2")||ad.getAttribute("y1")==ad.getAttribute("y2"));break;case"square":case"rect":ab=(ad.getAttribute("width")!=0||ad.getAttribute("height")!=0);break;case"circle":ab=(ad.getAttribute("r")!=0);break;case"ellipse":ab=(ad.getAttribute("rx")!=0||ad.getAttribute("ry")!=0);break;case"fhellipse":if((v-R)>0&&(u-P)>0){ad=f({element:"ellipse",attr:{cx:(R+v)/2,cy:(P+u)/2,rx:(v-R)/2,ry:(u-P)/2,id:Y(),fill:d,stroke:j,"stroke-width":e,"stroke-dasharray":O,opacity:T,"stroke-opacity":g,"fill-opacity":t}});a("changed",[ad]);ab=true}break;case"fhrect":if((v-R)>0&&(u-P)>0){ad=f({element:"rect",attr:{x:R,y:P,width:(v-R),height:(u-P),id:Y(),fill:d,stroke:j,"stroke-width":e,"stroke-dasharray":O,opacity:T,"stroke-opacity":g,"fill-opacity":t}});a("changed",[ad]);ab=true}break;case"text":ab=true;k.clearSelection();k.addToSelection([ad]);break}W=null;L++;if(!ab&&ad!=null){ad.parentNode.removeChild(ad);ad=null}else{if(ad!=null){ad.setAttribute("opacity",T);s(ad);B.update();z(new InsertElementCommand(ad));a("changed",[ad])}}};this.save=function(){this.clearSelection();var c='<?xml version="1.0" standalone="no"?>\n';c+=m(y,0);this.saveHandler(c)};this.clear=function(){var ab=y.childNodes;var c=y.childNodes.length;var ac=0;this.clearSelection();for(var ad=0;ad<c;ad++){if(ab[ac].nodeType==1){ab[ac].parentNode.removeChild(ab[ac])}else{ac++}}H();a("cleared")};this.setResolution=function(c,ad){var ab=y.getAttribute("width"),ac=y.getAttribute("height");y.setAttribute("width",c);y.setAttribute("height",ad);z(new ChangeElementCommand(y,{width:ab,height:ac},"resolution"));a("changed",[y])};this.getMode=function(){return S};this.setMode=function(c){S=c};this.getStrokeColor=function(){return j};this.setStrokeColor=function(c){j=c;this.changeSelectedAttribute("stroke",c)};this.getFillColor=function(){return d};this.setFillColor=function(ad){d=ad;var c=[];var ab=b.length;while(ab--){var ac=b[ab];if(ac&&ac.tagName!="path"&&ac.tagName!="line"){c.push(ac)}}if(c.length>0){this.changeSelectedAttribute("fill",ad,c)}};this.getStrokeWidth=function(){return e};this.setStrokeWidth=function(c){e=c;this.changeSelectedAttribute("stroke-width",c)};this.getStrokeStyle=function(){return O};this.setStrokeStyle=function(c){O=c;this.changeSelectedAttribute("stroke-dasharray",c)};this.getOpacity=function(){return T};this.setOpacity=function(c){T=c;this.changeSelectedAttribute("opacity",c)};this.getFillOpacity=function(){return t};this.setFillOpacity=function(c){t=c;this.changeSelectedAttribute("fill-opacity",c)};this.getStrokeOpacity=function(){return g};this.setStrokeOpacity=function(c){g=c;this.changeSelectedAttribute("stroke-opacity",c)};this.updateElementFromJson=function(ab){var c=w.getElementById(ab.attr.id);if(c&&ab.element!=c.tagName){y.removeChild(c);c=null}if(!c){c=w.createElementNS(V,ab.element);y.appendChild(c)}F(c,ab.attr);s(c);return c};this.each=function(c){$(y).children().each(c)};this.bind=function(c,ab){x[c]=ab};this.setIdPrefix=function(c){n=c};this.getBold=function(){var c=b[0];if(c!=null&&c.tagName=="text"&&b[1]==null){return(c.getAttribute("font-weight")=="bold")}return false};this.setBold=function(c){var ab=b[0];if(ab!=null&&ab.tagName=="text"&&b[1]==null){this.changeSelectedAttribute("font-weight",c?"bold":"normal")}};this.getItalic=function(){var c=b[0];if(c!=null&&c.tagName=="text"&&b[1]==null){return(c.getAttribute("font-style")=="italic")}return false};this.setItalic=function(c){var ab=b[0];if(ab!=null&&ab.tagName=="text"&&b[1]==null){this.changeSelectedAttribute("font-style",c?"italic":"normal")}};this.getFontFamily=function(){return p};this.setFontFamily=function(c){p=c;this.changeSelectedAttribute("font-family",c)};this.getFontSize=function(){return q};this.setFontSize=function(c){q=c;this.changeSelectedAttribute("font-size",c)};this.getText=function(){var c=b[0];if(c==null){return""}return c.textContent};this.setTextContent=function(c){this.changeSelectedAttribute("#text",c)};this.setRectRadius=function(ac){var c=b[0];if(c!=null&&c.tagName=="rect"){var ab=c.getAttribute("rx");if(ab!=ac){c.setAttribute("rx",ac);c.setAttribute("ry",ac);z(new ChangeElementCommand(c,{rx:ab,ry:ab},"Radius"));a("changed",[c])}}};this.changeSelectedAttribute=function(c,ah,ac){var ac=ac||b;var ab=new BatchCommand("Change "+c);var ad=ac.length;while(ad--){var ag=ac[ad];if(ag==null){continue}var af=(c=="#text"?ag.textContent:ag.getAttribute(c));if(af!=ah){if(c=="#text"){ag.textContent=ah}else{ag.setAttribute(c,ah)}D[ad]=ag.getBBox();B.requestSelector(ag).resize(D[ad]);var ae={};ae[c]=af;ab.addSubCommand(new ChangeElementCommand(ag,ae,c))}}if(!ab.isEmpty()){z(ab);a("changed",ac)}};$(G).mouseup(h);$(G).mousedown(l);$(G).mousemove(r);this.saveHandler=function(c){window.open("data:image/svg+xml;base64,"+Utils.encode64(c))};this.deleteSelectedElements=function(){var ab=new BatchCommand("Delete Elements");var c=b.length;for(var ad=0;ad<c;++ad){var af=b[ad];if(af==null){break}var ae=af.parentNode;var ac=af;B.releaseSelector(ac);var ag=ae.removeChild(ac);b[ad]=null;ab.addSubCommand(new RemoveElementCommand(ag,ae))}if(!ab.isEmpty()){z(ab)}a("selected",b)};this.moveToTopSelectedElement=function(){var ac=b[0];if(ac!=null){var ab=ac;var c=ab.parentNode;var ad=ab.nextSibling;if(ad==B.selectorParentGroup){ad=null}ab=ab.parentNode.appendChild(ab);z(new MoveElementCommand(ab,ad,c,"top"))}};this.moveToBottomSelectedElement=function(){var ac=b[0];if(ac!=null){var ab=ac;var c=ab.parentNode;var ad=ab.nextSibling;if(ad==B.selectorParentGroup){ad=null}ab=ab.parentNode.insertBefore(ab,ab.parentNode.firstChild);z(new MoveElementCommand(ab,ad,c,"bottom"))}};this.moveSelectedElement=function(ac,c){var ab=new BatchCommand("position");var ad=b.length;while(ad--){var ae=b[ad];if(ae!=null){D[ad]=ae.getBBox();D[ad].x+=ac;D[ad].y+=c;var af=U(ad);if(af){ab.addSubCommand(af)}B.requestSelector(ae).resize(D[ad])}}if(!ab.isEmpty()){z(ab);a("changed",b)}};var H=function(){o=[];M=0};this.getUndoStackSize=function(){return M};this.getRedoStackSize=function(){return o.length-M};this.getNextUndoCommandText=function(){if(M>0){return o[M-1].text}return""};this.getNextRedoCommandText=function(){if(M<o.length){return o[M].text}return""};this.undo=function(){if(M>0){this.clearSelection();var c=o[--M];c.unapply();a("changed",c.elements())}};this.redo=function(){if(M<o.length&&o.length>0){this.clearSelection();var c=o[M++];c.apply();a("changed",c.elements())}}}var Utils={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(d){var b=new Array(Math.floor((d.length+2)/3)*4);var l,j,g;var k,h,f,e;var c=0,a=0;do{l=d.charCodeAt(c++);j=d.charCodeAt(c++);g=d.charCodeAt(c++);k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64}else{if(isNaN(g)){e=64}}b[a++]=this._keyStr.charAt(k);b[a++]=this._keyStr.charAt(h);b[a++]=this._keyStr.charAt(f);b[a++]=this._keyStr.charAt(e)}while(c<d.length);return b.join("")},rectsIntersect:function(b,a){return a.x<(b.x+b.width)&&(a.x+a.width)>b.x&&a.y<(b.y+b.height)&&(a.y+a.height)>b.y},};